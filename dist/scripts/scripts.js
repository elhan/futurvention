!function(){"use strict";var a=angular.module("fvApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","mgcrea.ngStrap.modal","mgcrea.ngStrap.helpers.dimensions","mgcrea.ngStrap.helpers.parseOptions","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.select","mgcrea.ngStrap.tab","mgcrea.ngStrap.collapse","mgcrea.ngStrap.button","mgcrea.ngStrap.alert","mgcrea.ngStrap.typeahead","config","angularFileUpload","ngImgCrop","duScroll","angular-carousel","ui.validate","breeze.angular","angucomplete"]);a.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/register",{templateUrl:"views/register.html",controller:"RegistrationCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/forgotPassword",{templateUrl:"views/forgotPassword.html",controller:"ForgotPwdCtrl"}).when("/resetPassword",{templateUrl:"views/resetPassword.html",controller:"ResetPwdCtrl"}).when("/apply",{templateUrl:"views/apply.html"}).when("/storefront/:userId",{templateUrl:"views/storefront.html",controller:"StorefrontCtrl",resolve:{profile:["$location","$route","ProfileSvc",function(a,b,c){return c.fetchProfile(a.absUrl())}],userId:["$route",function(a){return a.current.params.userId}]}}).when("/offer/:offerId",{templateUrl:"views/offer.html",controller:"OfferCtrl",resolve:{offer:["$route","OfferSvc",function(a,b){return b.fetchOffer(a.current.params.offerId)}]}}).otherwise({redirectTo:"/"})}]),a.value("duScrollGreedy",!0),a.config(["$alertProvider","$httpProvider",function(a,b){b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"],angular.extend(a.defaults,{animation:"am-fade-and-slide-top",placement:"top",duration:4,dismissable:!0,template:"views/components/alert.html"})}]),a.run(["breeze",function(a){!a&&console.log("breeze not loaded!")}])}(),function(){"use strict";angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"http://futurvention.herokuapp.com",fbApiKey:"675990215825778",liApiKey:"77xj8xhasosg9k",firebaseUrl:"https://fvapp.firebaseio.com/"})}(),function(){"use strict";var a=angular.module("fvApp");a.constant("EVENTS",{profile:{fetchProfileFailed:"fetch-profile-failed",profileImageUpdated:"profile-image-updated"},user:{createSuccess:"user-creation-success",createFailed:"user-creation-failed",updateSuccess:"user-update-success",updateFailed:"user-update-failed"},auth:{registrationSuccess:"auth-registration-success",registrationFailed:"auth-registration-failed",loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"},ui:{providerSelected:"ui-provider-selected"}}),a.constant("USER_ROLES",{all:"*",admin:"admin",user:"user",guest:"guest"}),a.constant("PATHS",{root:"https://futurvention.azurewebsites.net/","public":"https://futurvention.azurewebsites.net/public.svc/",cached:"https://futurvention.azurewebsites.net/CachedPublic.svc/",account:{register:"https://futurvention.azurewebsites.net/api/AccountApi/Register",login:"https://futurvention.azurewebsites.net/api/AccountApi/Login",logout:"https://futurvention.azurewebsites.net/api/AccountApi/Logout",userInfo:"https://futurvention.azurewebsites.net/api/AccountApi/UserInfo"}}),a.constant("EMBEDLY",{key:"05b548d0a515404f8f3da52d93eb402f",domain:"http://api.embed.ly/1/",oembedAPI:"oembed"}),a.constant("MESSAGES",{error:{generic:"Something went wrong. Please try again later.",logoutFailed:"Something went wrong. Please try logging out again."},success:{createNewPassword:"We sent you an email. Follow the instructions to create a new password.",resetPassword:"Your password has been reset!"}})}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvSlider",["$document","$timeout",function(a,b){var c=40,d=38;return{restrict:"E",templateUrl:"views/directives/fv-slider.html",link:function(e,f,g){function h(a){b(function(){"up"===e.direction?e.index++:e.index--},l*a)}function i(){return function(a){var b=window.event||a,c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail));return e.$apply(e.goToSlide(0>c?e.index+1:e.index-1)),!1}}function j(a){a.keyCode===c&&e.$apply(function(){e.goToSlide(e.index+1)}),a.keyCode===d&&e.$apply(function(){e.goToSlide(e.index-1)})}var k=600,l=200,m=!1;g.fullscreen&&angular.element("body").css("overflow","hidden"),e.options={fullscreen:g.fullscreen,keyboard:g.keyboard,count:g.count||0,slidename:g.slidename||"slide",indicator:g.indicator,navbtn:g.navbtn},e.slides=[];for(var n=0;n<g.count;n++)e.slides.push(g.slidename+n);e.index=0,e.direction="up",e.speed=800,e.goToSlide=function(a){var c=0;if(!(m||0>a||a===e.slides.length)){m=!0,b(function(){m=!1},1e3,!1),e.direction=e.index>a?"down":"up",c=Math.abs(e.index-a),e.speed=k-(c-1)*l;for(var d=0;c>d;d++)h(d)}},angular.element(a).on("keydown",j),document.addEventListener&&(document.addEventListener("mousewheel",i(),!1),document.addEventListener("DOMMouseScroll",i(),!1)),e.$on("$destroy",function(){g.fullscreen&&angular.element("body").css("overflow","auto"),angular.element(a).off("keydown"),angular.element(a).off("mousewheel"),angular.element(a).off("DOMMouseScroll")})}}}]),a.directive("fvScrollBottom",["$window","$document","$timeout",function(a,b,c){return{restrict:"A",link:function(d,e,f){d.$on(f.scrolltrigger,function(){c(function(){a.scrollTo(0,angular.element(b)[0].body.scrollHeight)})})}}}]),a.directive("fvScrollTo",["$document","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){b(e.fvScrollTo&&a.scrollToElement(d))}}}]),a.directive("fvAutoFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){c&&c.focus&&a(function(){c.focus()})}}}]),a.directive("fvFocusInput",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){a(function(){var b=document.getElementsByName(d.focusInput)[0];b&&c.on(d.focusOn,function(){a(function(){b.focus()})})})}}}]),a.directive("fvBgImage",function(){return{restrict:"A",link:function(a,b,c){c.$observe("fvBgImage",function(a,c){a&&a!==c&&b.css({"background-image":["url(",a,")"].join(""),"background-size":"cover"})},!0)}}}),a.directive("fvDraggable",function(){return function(a,b,c){var d=b[0];return c.fvDraggable===!1?void d.removeAttr("draggable"):(d.draggable=!0,void d.addEventListener("dragstart",function(a){return a.dataTransfer.effectAllowed="move",c.fvData&&a.dataTransfer.setData("Text",JSON.stringify(c.fvData)),!1},!1))}}),a.directive("fvDroppable",function(){return{scope:{},link:function(a,b,c){var d=b[0];c.fvDropClass&&d.addEventListener("dragenter",function(){return this.classList.add(c.fvDropClass),!1},!1),c.fvDropClass&&d.addEventListener("dragleave",function(){return this.classList.remove(c.fvDropClass),!1},!1),d.addEventListener("dragover",function(a){return a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="move",!1},!1),d.addEventListener("drop",function(a){return a.stopPropagation&&a.stopPropagation(),c.fvDropClass&&this.classList.remove(c.fvDropClass),!1},!1)}}}),a.directive("fvOnDrop",function(){return{restrict:"A",link:function(a,b,c){b[0].addEventListener("drop",function(b){a.$apply(_.bind(a[c.fvOnDrop],{event:b},a.item))})}}}),a.directive("fvTimelineH",function(){return{restrict:"E",templateUrl:"views/directives/fv-timeline-h.html",link:function(){}}}),a.directive("fvDynamicName",["$compile","$parse",function(a,b){return{restrict:"A",terminal:!0,priority:1e5,link:function(c,d){var e=b(d.attr("fv-dynamic-name"))(c);d.removeAttr("fv-dynamic-name"),d.attr("name",["input","-",e].join("")),a(d)(c)}}}]),a.directive("fvToggleClass",function(){return function(a,b,c){c.fvOn&&c.fvClass&&b[0].addEventListener(c.fvOn,function(){this.classList.toggle(c.fvClass)})}}),a.directive("fvTabs",function(){return function(a,b){var c=_.filter(b.children(),function(a){return a.hasAttribute("fv-pane")});_.forEach(c,function(b,c){b.addEventListener("click",function(){a.$emit("pane-clicked",c)})}),a.$on("pane-clicked",function(a,b){_.forEach(c,function(a,c){b===c?angular.element(a).addClass("active"):angular.element(a).removeClass("active")})})}})}(),function(){"use strict";var a=angular.module("fvApp");a.service("LocalStorageSvc",function(){return this.getSession=function(){return JSON.parse(localStorage.getItem("firebaseSession"))},this}),a.service("ProfileSvc",["$http","$q","$upload","$timeout","EVENTS",function(a,b,c,d,e){var f={},g=["linkedIn","oDesk","elance","pph","freelancer","behance","dribbble","github"],h=["import","info","service_selection","offer_config","storefront"],i="import",j={};return f.Provider=function(a,b){this.name=a,this.url=b},f.initProviders=function(){var a=this,b={};return _.forEach(g,function(c){b[c]=new a.Provider(c,"")}),b},f.updateProfile=function(a){angular.extend(j,a)},f.getActiveStep=function(){return i},f.getProfile=function(){return j},f.getSteps=function(){return h},f.setActiveStep=function(a){i=a},f.saveProvider=function(a){var c=b.defer();return d(function(){c.resolve("provider saved: "+a.toString())},2e3),c.promise},f.saveProfileImage=function(a){console.log(!a);var c=b.defer();return d(function(){c.resolve("profile image saved")}),c.promise},f.savePersonalUrl=function(a){console.log(a);var c=b.defer();return d(function(){c.resolve("personal url saved")}),c.promise},f.saveProfile=function(a){console.log(a);var c=b.defer();return d(function(){c.resolve("profile info saved")}),c.promise},f.fetchProfile=function(a){var c=b.defer();return d(function(){"http://localhost:9000/#/storefront/666997733407685"!==a&&c.reject(e.profile.fetchProfileFailed),c.resolve({image:"images/backgrounds/bg3.jpg",firstName:"Doug",lastName:"Zagofsky",title:"Web & Logo Designer",city:"New York",country:"USA",personalUrl:"http://localhost:9000/#/storefront/666997733407685",status:"ProfileComplete",bio:"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. "})}),c.promise},f.fetchPersonalUrlStatus=function(a){var c=b.defer();return d(function(){c.resolve("http://localhost:9000/#/storefront/666997733407685"===a)},2e3),c.promise},f.removeProvider=function(a){var c=b.defer();return d(function(){c.resolve("provider removed: "+a.toString())},2e3),c.promise},f}]),a.service("PortfolioSvc",["$http","$q","$timeout",function(a,b,c){var d={},e={};return d.updatePortfolio=function(a){angular.extend(e,a)},d.getPortfolio=function(){return e},d.fetchPortfolio=function(a,d,e){console.log(a,d,e);for(var f=function(){return{title:"Logo Design",url:"http://www.accusoft.com/html5viewer/img/btn-file-icon-ppt-sm.png",name:"btn-file-icon-ppt-sm.png"}},g=_.random(3,20),h=[],i=0;g>i;i++)h.push(new f);var j=b.defer();return c(function(){j.resolve({items:h})}),j.promise},d}]),a.service("ReviewSvc",["$http","$q","$timeout","Enum",function(a,b,c,d){var e={};return e.fetchReceivedReviews=function(a,e,f){console.log(a,e,f);for(var g=_.values(d.Providers),h=_.random(0,g.length),i=function(){return{reviewer:{firstName:"Mark",lastName:"Twain"},provider:g[h],rating:_.random(1,5),timeAgo:"3 days ago",text:"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. "}},j=_.random(3,20),k=[],l=0;j>l;l++)k.push(new i);var m=b.defer();return c(function(){m.resolve(k)}),m.promise},e}]),a.service("MessagingSvc",["$http","$q","$timeout",function(a,b,c){var d={};return d.sendMessage=function(a,d,e,f,g){console.log(g);var h=b.defer();return c(function(){h.resolve(g)}),h.promise},d}]),a.service("NotificationSvc",["$http","$q","$alert",function(a,b,c){var d={};return d.show=function(a){var d=c(a),e=b.defer();return e.resolve(d),e.promise},d}]),a.service("EmbedlySvc",["$http","EMBEDLY",function(a,b){this.oembed=function(c,d,e){return a.get([b.domain,b.oembedAPI,"?key=",b.key,"&urls=",_.pluck(c,"url").map(encodeURI).join(","),"&maxwidth=",d,"&maxheight=",e,"&format=json"].join(""))}}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("Enum",function(){var a={};return a.OfferStatus=Object.freeze({AUDIO:"audio",IMAGE:"image",INLINE_TEXT:"inline_text",TEXT:"text",VIDEO:"video"}),a.ShowcaseFileType=Object.freeze({LINKED:"linked",HOSTED:"hosted"}),a.Providers=Object.freeze({LINKEDIN:"linkedIn",ODESK:"oDesk",ELANCE:"elance",PPH:"pph",FREELANCER:"freelancer",BEHANCE:"behance",DRIBBBLE:"dribbble",GITHUB:"github"}),a})}(),function(){"use strict";var a=angular.module("fvApp");a.service("Utils",function(){var a={};return a.URL_PATTERN=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#!\(\)-]*[\w@?^=%&amp;\/~+#-])?/gim,a.PSEUDO_URL_PATTERN=/(^|[^\/])(www\.[\S]+(\b|$))/gim,a.ELANCE_URL_PATTERN=/^http[s]?:\/\/([^\/]*elance.com)/i,a.isVideo=function(a){var b=new RegExp(/video\/*/g);return b.test(a)},a.getUrlParams=function(a){var b,c;if(a){for(var d=0;d<a.length;++d)c=a[d].split("=",2),b[c[0]]=1===c.length?"":decodeURIComponent(c[1].replace(/\+/g," "));return b}},a.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},a}),Array.prototype.hasOwnProperty("swap")||(Array.prototype.swap=function(a,b){var c=this[a];return this[a]=this[b],this[b]=c,this}),Array.prototype.hasOwnProperty("empty")||(Array.prototype.empty=function(){for(;this.length>0;)this.pop()}),Array.prototype.hasOwnProperty("removed")||(Array.prototype.remove=function(a){if("function"!=typeof a)return void 0;for(var b=0;b<this.length;b++)if(a(this[b]))return this.splice(b,1);return void 0}),Array.prototype.hasOwnProperty("merge")||(Array.prototype.merge=function(a){if(!a instanceof Array)return void 0;for(var b=0;b<a.length;b++)this.push(a[b]);return this})}(),function(){"use strict";var a=angular.module("fvApp");a.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),a.filter("prizmUrl",function(){return function(a){return["http://connect.ajaxdocumentviewer.com/?key=K4102014161530&viewertype=html5&document=",a,"&viewerheight=100%&viewerwidth=100%&printButton=Yes&toolbarColor=CCCCCC"].join("")}})}(),function(){"use strict";var a=angular.module("fvApp");a.controller("MainCtrl",["$scope","$location","EVENTS","MESSAGES","AccountSvc","NotificationSvc",function(a,b,c,d,e,f){a.setCurrentUser=function(b){a.currentUser=b},a.updateCurrentUser=function(b){angular.extend(a.currentUser,b)},a.go=function(a){b.path(a)},a.locationAt=function(a){return a===b.path()},a.$on("$routeChangeError",function(b,c,e,g){console.log(g),f.show({content:d.error.generic,type:"error"}),a.go("/")}),a.$on(c.auth.loginSuccess,function(){e.getUserInfo().then(function(b){console.log(b),a.setCurrentUser=b,a.go(a.locationAt("/register")?"/apply":"/")},function(a){console.log(a),f.show({content:d.error.generic,type:"error"})})}),a.$on(c.auth.logoutSuccess,function(){a.setCurrentUser({}),a.go("/")}),a.$on(c.auth.logoutFailed,function(){f.show({content:d.error.logoutFailed,type:"error"})})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("RegistrationCtrl",["$scope","$rootScope","EVENTS","AccountSvc",function(a,b,c,d){a.newUser={firstName:"",lastName:"",email:"",password:""},a.authError={emailTaken:!1,invalidEmail:!1,invalidPassword:!1},a.register=function(a){d.register(a).then(function(){d.getUserInfo().then(function(a){console.log(a)},function(a){console.log(a)})},function(a){console.log(a)})},a.$on(c.auth.registrationFailed,function(b,c){switch(c.code){case"EMAIL_TAKEN":a.authError.emailTaken=a.newUser.email;break;case"INVALID_EMAIL":a.authError.invalidEmail=a.newUser.email;break;default:console.log(b,c)}})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("LoginCtrl",["$scope","$rootScope","EVENTS","MESSAGES","AccountSvc","NotificationSvc",function(a,b,c,d,e,f){a.newUser={email:"",password:""},a.authError={invalidEmail:!1,invalidPassword:!1},a.login=function(g){e.login(g).then(function(a){console.log(a),b.$broadcast(c.auth.loginSuccess,event)},function(b){switch(b.code){case"INVALID_USER":a.authError.invalidUser=a.newUser.email;break;case"INVALID_EMAIL":a.authError.invalidEmail=a.newUser.email;break;case"INVALID_PASSWORD":a.authError.invalidPassword=a.newUser.password;break;default:console.log(event,b),f.show({content:d.error.generic,type:"error"})}})}}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("StorefrontCtrl",["$scope","$modal","$timeout","$location","ProfileSvc","PortfolioSvc","OfferSvc","ReviewSvc","MessagingSvc","NotificationSvc","profile","userId","EVENTS",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b({scope:a,template:"views/components/modalContactUser.html",show:!1,animation:"am-slide-top",keyboard:!1}),o=b({scope:a,template:"views/components/modalPortfolioViewer.html",show:!1,animation:"am-slide-top",keyboard:!1}),p=b({scope:a,template:"views/components/modalImageCrop.html",show:!1,animation:"am-slide-top",keyboard:!0});a.portfolio=f.getPortfolio(),a.profile=k,a.userId=l,a.isCurrentUser=d.absUrl()===a.profile.personalUrl,a.reviews={},a.offers=[],a.message="",a.sender={firstName:"",lastName:"",email:""},a.steps=e.getSteps(),a.activeStep=a.steps[4],a.range=function(a){return _.range(0,a)},a.contactUser=function(){i.sendMessage(a.userId,a.currentUser.id,a.sender.firstName,a.sender.lastName,a.message).then(function(){j.show({content:"Your message was successfuly sent!",type:"success"}).then(function(){c(a.closeContactModal)})},function(a){console.log(a)})},a.editProfileSection=function(b){e.setActiveStep(b),a.go("/apply")},a.removeOffer=function(b){g.removeOffer(b),a.offers=g.offers},a.editOffer=function(b){g.setOffer(_.find(a.offers,function(a){return a.serviceName===b})),g.fetchOffer(b,a.userId).then(function(b){g.setOffer(b),a.activeStep=a.steps[3]},function(a){console.log(a)}),a.editProfileSection("offer_config")},a.showContactModal=function(){n.$promise.then(n.show)},a.closeContactModal=function(){n.$promise.then(n.hide)},a.showPortfolioViewerModal=function(){o.$promise.then(o.show)},a.showImageCropModal=function(){a.isCurrentUser&&p.$promise.then(function(){a.croppedImage="",p.show()})},e.fetchProfile(d.absUrl()).then(function(b){a.isCurrentUser=d.absUrl()===b.personalUrl,a.profile=b},function(a){console.log(a)}),g.fetchOffers(a.userId).then(function(b){a.offers=b},function(a){console.log(a)}),f.fetchPortfolio(a.userId).then(function(b){f.updatePortfolio(b),a.portfolio=f.getPortfolio()},function(a){console.log(a)}),h.fetchReceivedReviews(a.userId).then(function(b){a.reviews=b},function(a){console.log(a)}),a.$on(m.profile.profileImageUpdated,function(){a.profile.image=e.getProfile().image})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ServiceSelectCtrl",["$scope","$timeout","CatalogueSvc","OfferSvc",function(a,b,c,d){a.offset=0,a.batch=c.batch,a.offers=[],a.services=[],a.categories=[],a.allServices=[],a.selectedService={},a.getServices=function(){c.getServices(a.offset).then(function(b){a.services.merge(b),a.services.totalCount=b.length,a.allServices=c.services},function(a){console.log(a)})},a.getServicesUnderCategory=function(b){c.getServicesUnderCategory(b,a.offset).then(function(b){a.services.merge(b.services),a.services.totalCount=b.totalCount},function(a){console.log(a)})},a.showMore=function(){a.offset+=a.batch;var b=a.categories[a.categories.activeCategoryIndex].categoryID;null===b?a.getServices():a.getServicesUnderCategory(b)},c.getRootCategories().then(function(b){a.categories=b,a.categories.activeCategoryIndex=0},function(a){console.log(a)}),a.createOffer=function(c){d.setOffer(new d.Offer),d.updateOffer({serviceID:c}),b(function(){a.goToStep(3)})},a.$watch("categories.activeCategoryIndex",function(b,c){switch(!0){case void 0===typeof b||b===c||0===a.categories.length:break;case 0===b:a.offset=0,a.services.empty(),a.getServices();break;default:a.offset=0,a.services.empty(),a.getServicesUnderCategory(a.categories[b].categoryID)}}),a.$watch("selectedService.serviceID",function(b){b&&a.createOffer(b)})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("OfferConfigCtrl",["$scope","$timeout","$modal","$upload","$location","CatalogueSvc","EmbedlySvc","ProfileSvc","OfferSvc",function(a,b,c,d,e,f,g,h,i){a.urlsToEmbed=[{url:""}],a.showcaseItems=[],a.offer=i.getOffer(),a.service={},a.priceDiscriminators=[],a.addons=[],a.deadlines=["1 day","2 days","3 days","4 days","5 days","6 days","7 days","8 days","9 days","10 days"],a.extraDeadlines=["1 extra day","2 extra days","3 extra days","4 extra days","5 extra days","6 extra days","7 extra days","8 extra days","9 extra days","10 extra days"],a.offer=i.getOffer(),f.getService(a.offer.serviceID).then(function(b){console.log(b),a.service=b,a.priceDiscriminators=_.filter(b.options,function(a){return a.isPriceDiscriminator}),a.addons=_.filter(b.options,function(a){return a.isPriceDiscriminator&&!a.isMandatory})},function(a){console.log(a)}),a.panels=[{title:"Service Description",state:"default"},{title:"Work Samples",state:"default"},{title:"Personalize your offering",state:"default",textonly:!1},{title:"Pricing / Deadlines",state:"default"}],a.panels.activePanel=0,b(function(){a.panels.activePanel=0});var j=c({scope:a,template:"views/components/modalEmbedUrl.html",show:!1,keyboard:!1,animation:"am-slide-top"}),k=c({scope:a,template:"views/components/modalCameraTag.html",show:!1,keyboard:!1,backdrop:"static",animation:"am-slide-top"});a.showEmbedUrlModal=_.throttle(function(){j.$promise.then(function(){j.show()})},700),a.showCameraTagModal=function(){k.$promise.then(function(){k.show()})},a.closeEmbedUrlModal=function(){a.urlsToEmbed.empty(),j.hide()},a.closeCameraTagModal=function(){k.hide()},a.addUrls=function(){g.oembed(a.urlsToEmbed).then(function(b){_.each(b.data,function(b){a.showcaseItems.push({name:b.thumbnail_url,link:b.thumbnail_url,state:"loaded"}),a.closeEmbedUrlModal()})},function(a){console.log(a)})},a.setPanelState=function(a,b){a.state=b},a.closePanel=function(b){a.setPanelState(b,"done"),a.panels.activePanel=a.panels.indexOf(_.find(a.panels,function(a){return"default"===a.state}))},a.onFileSelect=function(b){_.each(b,function(b){var c;_.where(a.showcaseItems,{name:b.name}).length>0||(a.showcaseItems.push({name:"Loading...",link:"",state:"loading"}),c=a.showcaseItems.length-1,d.upload({url:"http://localhost:3000/upload",method:"POST",headers:{"x-filename":b.name},file:b}).success(function(){var d=new FileReader;d.onload=function(d){a.$apply(function(){_.assign(a.showcaseItems[c],{name:b.name,link:d.target.result,state:"loaded"})})},d.readAsDataURL(b)}).error(function(d){console.log(d);var e=new FileReader;e.onload=function(d){a.$apply(function(){_.assign(a.showcaseItems[c],{name:b.name,link:d.target.result,state:"loaded"})})},e.readAsDataURL(b)}))})},a.rearangeShowcaseItems=function(b){var c,d,e=JSON.parse(this.event.dataTransfer.getData("Text")),f=b.link;e!==f&&(c=a.showcaseItems.indexOf(_.where(a.showcaseItems,{link:e})[0]),d=a.showcaseItems.indexOf(_.where(a.showcaseItems,{link:f})[0]),a.showcaseItems=a.showcaseItems.swap(c,d))},a.toggleSelection=function(a){switch(a.state){case"selected":a.state="loaded";break;case"loaded":a.state="selected";break;default:return}},a.toggleTextOnly=function(){var b=a.panels[a.panels.activePanel];b.hasOwnProperty("textonly")&&(b.textonly=!b.textonly)},a.$watch("panels.activePanel",function(){var b=_.find(a.panels,function(a){return"done"!==a.state});!b&&a.goToStep(2)}),a.$on("modal.show",function(){CameraTag.setup(),CameraTag.observe("fvcam","published",function(){var a=CameraTag.cameras.fvcam,b=a.getVideo();console.log(b)})})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ApplyCtrl",["$scope","ProfileSvc",function(a,b){a.steps=b.getSteps(),a.activeStep=b.getActiveStep(),a.goToStep=function(c){a.activeStep=a.steps[c],b.setActiveStep(a.activeStep)},a.goToStep(2)}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ApplyInfoCtrl",["$scope","$modal","$timeout","ProfileSvc","LocationSvc","EVENTS",function(a,b,c,d,e,f){var g=b({scope:a,template:"views/components/modalImageCrop.html",show:!1,animation:"am-slide-top",keyboard:!0});a.showImageCropModal=function(){g.$promise.then(function(){a.croppedImage="",g.show()})},a.personalUrlExists=!1,a.profileImage=d.getProfile().image,a.personalUrl="",a.title="",a.selectedCity="",a.cities=[],a.country="",a.countries=[],a.countryName="",a.countryNames=[],e.getCountries().then(function(b){a.countries=b,a.countryNames=_.pluck(b,"name")},function(a){console.log(a)}),a.getProfile=function(){return d.getProfile()},a.savePersonalUrl=function(){d.savePersonalUrl(a.personalUrl).then(function(b){console.log(b),d.updateProfile({personalUrl:a.personalUrl})},function(b){console.log(b),a.personalUrlExists=!0})},a.continue=function(){var b={firstName:a.currentUser.firstName,lastName:a.currentUser.lastName,title:a.title,bio:a.bio,city:a.selectedCity,country:a.country};d.saveProfile(b).then(function(c){console.log(c),d.updateProfile(b),console.log(d.getProfile()),a.goToStep(2)},function(a){console.log(a)})},a.searchCity=_.throttle(function(b){b&&e.searchCity(a.country.countryID,b).then(function(b){c(function(){a.cities=b})},function(a){console.log(a)})},700),a.$on(f.profile.profileImageUpdated,function(){a.profileImage=d.getProfile().image}),a.$watch("countryName",function(b,c){b!==c&&(a.country=_.find(a.countries,function(b){return b.name===a.countryName}))})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ApplyImportCtrl",["$scope","$timeout","EVENTS","ProfileSvc",function(a,b,c,d){a.providers=d.initProviders(),a.selectedProviders=[],a.toggleSelection=function(b){var d=a.providers[b];d.selected=!d.selected,d.selected?(a.$broadcast(c.ui.providerSelected,b),a.selectedProviders.push(d)):_.remove(a.selectedProviders,function(a){return a.name===d.name})},a.isSelected=function(b){return a.providers[b].selected},a.hasUnsavedProviders=function(){return _.find(a.selectedProviders,function(a){return!a.saved})},a.saveProvider=function(b){var c=a.providers[b];c.inProgress=!0,d.saveProvider(c).then(function(a){console.log(a),c.saved=!0,c.inProgress=!1,d.updateProfile({providers:new d.Provider(c.name,c.url)}),console.log(d.getProfile())},function(a){c.inProgress=!1,console.log(a)})},a.removeProvider=function(b){b.inProgress=!0,d.removeProvider(b).then(function(){b.selected=!1,b.saved=!1,b.inProgress=!1,b.url="",_.remove(a.selectedProviders,b),d.updateProfile({providers:new d.Provider(b.name,"")}),console.log(d.getProfile())},function(a){b.inProgress=!1,console.log(a)})},a.editProvider=function(a){a.saved=!1}}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("OfferCtrl",["$scope","offer","ReviewSvc","UserSvc","PortfolioSvc","CatalogueSvc","$modal",function(a,b,c,d,e,f,g){a.reviews=[],a.portfolio={},a.service={},a.offer=b;var h=g({scope:a,template:"views/components/modalContactUser.html",show:!1,animation:"am-slide-top",keyboard:!1});a.range=function(a){return _.range(0,a)},a.showContactModal=function(){h.$promise.then(h.show)},a.closeContactModal=function(){h.$promise.then(h.hide)},a.user=d.User("Mark","Twain"),e.fetchPortfolio(a.user.userId).then(function(b){e.updatePortfolio(b),a.portfolio=e.getPortfolio()},function(a){console.log(a)}),c.fetchReceivedReviews(a.user.userId).then(function(b){a.reviews=b},function(a){console.log(a)}),f.getService().then(function(b){a.service=b},function(a){console.log(a)})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ModalImageCropCtrl",["$scope","ProfileSvc","$timeout","EVENTS",function(a,b,c,d){a.profileImage=b.getProfile().image,a.init=function(b){a.uncroppedImage="",a.croppedImage="",a.tempImage="",a.setProgress(b)},a.updateCroppedImage=function(b){a.croppedImage=b},a.onFileSelect=function(b){var d=new FileReader;d.onloadstart=function(){a.setProgress(!0)},d.onload=function(b){c(function(){a.uncroppedImage=b.target.result,a.setProgress(!1)})},d.readAsDataURL(b[0])},a.setProgress=function(b){a.inProgress=b},a.getProfile=function(){return b.getProfile()},a.saveProfileImage=function(){b.saveProfileImage(a.croppedImage).then(function(c){console.log(c),b.updateProfile({image:a.croppedImage}),a.profileImage=angular.copy(a.croppedImage),a.$emit(d.profile.profileImageUpdated),a.$hide()},function(a){console.log(a)})},a.init()}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ForgotPwdCtrl",["$scope","AccountSvc","MESSAGES","NotificationSvc",function(a,b,c,d){a.email="",a.forgotPassword=function(){b.forgotPassword(a.email).then(function(b){console.log(b),d.show({content:c.success.createNewPassword,type:"success"}).then(function(){a.go("/login")})},function(){d.show({content:c.error.generic,type:"error"})})}}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ResetPwdCtrl",["$scope","MESSAGES","AccountSvc","NotificationSvc",function(a,b,c,d){a.email="",a.resetPassword=function(){c.resetPassword(a.email).then(function(){d.show({content:b.success.resetPassword,type:"success"}).then(function(){a.go("/login")})},function(){d.show({content:b.error.generic,type:"error"})})}}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("HeaderCtrl",["$scope","$rootScope","EVENTS","AccountSvc",function(a,b,c,d){a.logout=function(){d.logout().then(function(){b.$broadcast(c.auth.logoutSuccess,event)},function(a){b.$broadcast(c.auth.logoutFailed,event,a)})}}])}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvOrderBox",function(){return{restrict:"E",scope:{offer:"@"},templateUrl:"views/directives/fv-order-box.html",link:function(a){a.priceDiscriminators=[{text:"500 words",value:10},{text:"700 words",value:12},{text:"1000 words",value:15}],a.addons=[{text:"Unlimited revisions",value:20},{text:"3 initial concepts",value:30},{text:"1 day delivery",value:30}]}}})}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvPortfolioViewer",["PortfolioSvc",function(a){var b=7;return{restrict:"E",scope:!0,templateUrl:"views/directives/fv-portfolio-viewer.html",link:function(c){c.portfolio=a.getPortfolio(),c.showcasePrev=function(){c.showcaseIndex>0&&(c.showcaseIndex-=1)},c.showcaseNext=function(){c.showcaseIndex<c.portfolio.items.length-1&&(c.showcaseIndex+=1)},c.goToShowcaseItem=function(a){c.showcaseIndex=a},c.$watch("showcaseIndex",function(a,d){a>=b&&a>d&&(c.galleryIndex+=1),a>0&&d>a&&(c.galleryIndex-=1)})}}}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("LocationSvc",["$q","$http","breeze","PATHS",function(a,b,c,d){function e(a){return _.pluck(a.results[0].value,function(a){return{name:a.Name.Literals[0].Text,countryID:a.ID}})}function f(a){return _.pluck(a.data.value,function(a){return a.Name.Literals[0].Text})}var g={},h=new c.DataService({serviceName:d.public,hasServerMetadata:!1}),i=new c.EntityManager({dataService:h});
return g.searchCity=function(c,e){console.log(e);var g=a.defer(),h=[d.public,"CitiesByPrefix","?format=json","&countryID=",c,"&prefix=","'",e,"'","&$format=json","&$expand=Name/Literals"].join("");return b.get(h).then(function(a){g.resolve(f(a))},function(a){g.reject(a)}),g.promise},g.getCountries=function(){var b=a.defer(),d=new c.EntityQuery("CountriesLocations").expand("Name.Literals");return i.executeQuery(d).then(function(a){b.resolve(e(a))},function(a){console.log(a)}),b.promise},g}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("AccountSvc",["$q","$http","PATHS",function(a,b,c){var d={};return d.register=function(a){return b.post(c.account.register,{Email:a.email,Password:a.password,ConfirmPassword:a.password,FirstName:a.firstName,LastName:a.lastName})},d.login=function(a){return b({url:c.account.login,method:"POST",data:{Email:a.email,Password:a.password,RememberMe:!0},withCredentials:!0,headers:{"Content-Type":"application/json; charset=utf-8"}})},d.logout=function(){return b.post(c.account.logout,{})},d.forgotPassword=function(b){var c=a.defer();return c.resolve(b),c.promise},d.resetPassword=function(b){var c=a.defer();return c.resolve(b),c.promise},d.getUserInfo=function(){return b.get(c.account.userInfo)},d}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("CatalogueSvc",["$http","$q","$timeout","breeze","PATHS",function(a,b,c,d,e){function f(a){return _.pluck(a.results[0].value,function(a){return{categoryID:a.ID,categoryName:a.Name.Literals[0].Text}})}function g(a){return _.pluck(a.results[0].value,function(a){return{serviceID:a.ID,shortTitle:a.ShortTitle.Literals[0].Text,thumbnail:{link:a.ThumbnailFile.Url}}})}function h(a){return a.results[0]["odata.count"]}function i(a){var b=a.results[0].value[0],c={serviceID:b.ID,shortTitle:b.ShortTitle&&b.ShortTitle.Literals[0].Text,description:b.Description&&b.Description.Literals[0].Text,deliverables:b.ExpectedDeliverables&&b.ExpectedDeliverables.Literals[0].Text,provision:b.BuyerProvision&&b.BuyerProvision.Literals[0].Text,options:b.Options,excluded:b.ExcludedServices&&b.ExcludedServices.Literals[0].Text,viewHint:b.ViewHint,thumbnail:{link:b.ThumbnailFile.Url},showcasePrompt:b.ShowcasePrompt&&b.ShowcasePrompt.Literals[0].Text};return c.allowedShowcaseFileTypes=_.pluck(b.AllowedShowcaseFileTypes,function(a){return a.Name&&a.Name.Literals[0].Text}),c.options=b.Options.map(function(a){return{isPriceDiscriminator:a.IsPriceDiscriminator,isMandatory:a.IsMandatory,isDaysDiscriminator:a.IsDaysDiscriminator,name:a.Name,choices:a.Choices.map(function(a){return{name:a.Name&&a.Name.Literals[0].Text,value:a.value}})}}),c.fields=b.Fields.map(function(a){return{allowedFileTypes:_.pluck(a.AllowedFileTypes,function(a){return a.Name&&a.Name.Literals[0].Text}),order:a.Order,isRequired:a&&a.IsRequired?!0:!1,sellerLabel:a&&a.SellerLabel&&a.SellerLabel.Literals[0].Text}}),c.interview=_.find(c.fields,function(a){return 0===a.order}),_.remove(c.fields,function(a){return 0===a.order}),c}var j={},k=new d.DataService({serviceName:e.cached,hasServerMetadata:!1}),l=new d.EntityManager({dataService:k});return j.services=[],j.batch=16,j.getRootCategories=function(){var a=b.defer(),c=new d.EntityQuery("RootCategories").expand("Name.Literals");return l.executeQuery(c).then(function(b){var c=f(b);c.unshift({categoryID:null,categoryName:"All"}),a.resolve(c)},function(b){a.reject(b)}),a.promise},j.getService=function(a){var c=b.defer(),e=new d.EntityQuery("Services").where("ID","eq",a).expand(["ShortTitle.Literals","Description.Literals","ThumbnailFile","ExpectedDeliverables.Literals","BuyerProvision.Literals","ExcludedServices.Literals","AllowedShowcaseFileTypes.Name.Literals","ShowcasePrompt.Literals","Fields","Fields.AllowedFileTypes.Name.Literals","Fields.AllowedFileTypes.MimeTypes","Fields.SellerLabel.Literals","Fields.Order","Options.Choices.Name.Literals"].join(", "));return l.executeQuery(e).then(function(a){console.log(a),c.resolve(i(a))},function(a){c.reject(a)}),c.promise},j.getServices=function(a){var c=b.defer(),e=new d.EntityQuery("Services").expand("ShortTitle.Literals, ThumbnailFile");return j.services.length>0&&c.resolve(j.services.slice(a,a+j.batch)),0===j.services.length&&l.executeQuery(e).then(function(b){j.services=g(b),c.resolve(j.services.slice(a,a+j.batch))},function(a){c.reject(a)}),c.promise},j.getServicesUnderCategory=function(a,c){var e=b.defer(),f=new d.EntityQuery("ServicesUnderCategory").withParameters({CategoryID:a}).skip(c).take(j.batch).expand("ShortTitle.Literals, ThumbnailFile").inlineCount();return l.executeQuery(f).then(function(a){e.resolve({services:g(a),totalCount:h(a)})},function(a){e.reject(a)}),e.promise},j}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("OfferSvc",["$http","$q","$timeout","Enum",function(a,b,c,d){var e={},f={},g=[];return e.Offer=function(){return{workSamples:[],status:d.OfferStatus.DRAFT,serviceID:"",choices:[],lowestPrice:""}},f=new e.Offer,e.setOffer=function(a){f=a},e.updateOffer=function(a){angular.extend(f,a)},e.addWorkSamples=function(a){a&&_.each(a,function(a){f.workSmaples.push(a)})},e.addOffer=function(a){var b=a||f;g.push(b)},e.removeOffer=function(a){var b=a||f.serviceID;g.remove(function(a){return a.serviceID===b})},e.getOffer=function(){return f},e.fetchOffer=function(a,d){a&&console.log(a,d);var e=b.defer();return c(function(){e.resolve(f)}),e.promise},e.fetchOffers=function(){for(var a=_.random(3,20),d={},f=0;a>f;f++)d=new e.Offer,angular.extend(d,{serviceID:1,lowestPrice:"$100"}),g.push(d);var h=b.defer();return c(function(){h.resolve(g)}),h.promise},e}])}();