!function(){"use strict";var a=angular.module("fvApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","mgcrea.ngStrap.modal","mgcrea.ngStrap.helpers.dimensions","mgcrea.ngStrap.helpers.parseOptions","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.select","facebook","ngLinkedIn","config","firebase","angularFileUpload","ngImgCrop"]);a.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/register",{templateUrl:"views/register.html"}).when("/login",{templateUrl:"views/login.html"}).when("/apply",{templateUrl:"views/apply.html"})}]),a.config(["FacebookProvider","$linkedInProvider","ENV","AUTH_PROVIDER_OPTIONS",function(a,b,c,d){var e=d;a.init(c.fbApiKey,e.facebook),b.options({appKey:c.liApiKey,scope:e.linkedIn.scope,authorize:e.linkedIn.authorize,credentials_cookie:e.linkedIn.credentials_cookie})}])}(),function(){"use strict";angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"http://futurvention.herokuapp.com",fbApiKey:"675990215825778",liApiKey:"77xj8xhasosg9k",firebaseUrl:"https://fvapp.firebaseio.com/"})}(),function(){"use strict";var a=angular.module("fvApp");a.constant("EVENTS",{user:{createSuccess:"user-creation-success",createFailed:"user-creation-failed",updateSuccess:"user-update-success",updateFailed:"user-update-failed"},auth:{registrationSuccess:"auth-registration-success",registrationFailed:"auth-registration-failed",loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"},firebase:{firebaseConnected:"firebase-connected"},ui:{providerSelected:"ui-provider-selected"}}),a.constant("USER_ROLES",{all:"*",admin:"admin",user:"user",guest:"guest"}),a.constant("AUTH_PROVIDER_OPTIONS",{facebook:{scope:"public_profile, email"},linkedIn:{scope:"r_emailaddress r_fullprofile",fields:["id","first-name","last-name","email-address"],authorize:!0,credentials_cookie:!0}})}(),function(){"use strict";var a=angular.module("fvApp");a.controller("MainCtrl",["$scope","$location","USER_ROLES","AuthSvc","SessionSvc","LocalStorageSvc","UserSvc",function(a,b,c,d,e,f,g){function h(){var b=f.getSession(),c=g.getUser();(c||b)&&(a.setCurrentUser(g.getUser()),b?e.create(b.sessionKey,b.user.id,b.user.provider,a.userRoles.user):e.create(Math.random(),c.id,"linkedIn",a.userRoles.user))}a.userRoles=c,a.isAuthorized=d.isAuthorized,a.isAuthenticated=d.isAuthenticated,a.setCurrentUser=function(b){a.currentUser=b},a.go=function(a){b.path(a)},a.locationAt=function(a){return a===b.path()},a.$on("auth-logout-success",function(b){e.destroy(),a.setCurrentUser({}),console.log(b)}),a.$on("auth-login-success",function(b,c,d){"linkedIn"===d&&e.create(Math.random(),c,d,a.userRoles.user),h(),a.setCurrentUser(g.getUser(e.userId)),a.go(a.locationAt("/register")?"/apply":"/"),console.log(b)}),h()}]),a.controller("LoginCtrl",["$scope","$rootScope","$linkedIn","EVENTS","AUTH_PROVIDER_OPTIONS","AuthSvc","UserSvc",function(a,b,c,d,e,f,g){var h=e,i=d.auth,j=f.firebaseAuth();a.newUser={firstName:"",lastName:"",email:"",password:""},a.authError={emailTaken:!1,invalidEmail:!1,invalidPassword:!1},a.register=function(c){j.$createUser(c.email,c.password).then(function(d){b.$broadcast(i.registrationSuccess,d),a.login(c)},function(a){b.$broadcast(i.registrationFailed,a)})},a.loginFb=function(){j.$login("facebook",h.facebook).then(function(a){g.setUser({id:a.id,firstName:a.thirdPartyUserData.first_name,lastName:a.thirdPartyUserData.last_name,email:a.thirdPartyUserData.email}),b.$broadcast(i.loginSuccess,a.id,"facebook")},function(a){b.$broadcast(i.loginFailed,a)})},a.loginLi=function(){f.loginLi().then(function(){f.getLiProfile().then(function(a){g.setUser({id:a.values[0].id,firstName:a.values[0].firstName,lastName:a.values[0].lastName,email:a.values[0].emailAddress}),b.$broadcast(i.loginSuccess,a.values[0].id,"linkedIn")})})},a.login=function(a){j.$login("password",{email:a.email,password:a.password}).then(function(c){a.id=c.id,g.setUser(a),b.$broadcast(i.loginSuccess,c.id,"password")},function(a){b.$broadcast(i.loginFailed,a)})},a.logout=function(){j.$logout(),g.removeUser(),b.$broadcast(i.logoutSuccess,event)},a.$on("auth-registration-failed",function(b,c){switch(c.code){case"EMAIL_TAKEN":a.authError.emailTaken=a.newUser.email;break;case"INVALID_EMAIL":a.authError.invalidEmail=a.newUser.email;break;default:console.log(b,c)}}),a.$on("auth-login-failed",function(b,c){switch(c.code){case"INVALID_USER":a.authError.invalidUser=a.newUser.email;break;case"INVALID_EMAIL":a.authError.invalidEmail=a.newUser.email;break;case"INVALID_PASSWORD":a.authError.invalidPassword=a.newUser.password;break;default:console.log(b,c)}})}]),a.controller("ApplyCtrl",["$scope","ProfileSvc",function(a,b){a.steps=b.getSteps(),a.activeStep=a.steps[0],a.goToStep=function(b){a.activeStep=a.steps[b]}}]),a.controller("ApplyImportCtrl",["$scope","$timeout","EVENTS","ProfileSvc",function(a,b,c,d){a.providers=d.initProviders(),a.selectedProviders=[],a.toggleSelection=function(b){var d=a.providers[b];d.selected=!d.selected,d.selected?(a.$broadcast(c.ui.providerSelected,b),a.selectedProviders.push(d)):_.remove(a.selectedProviders,function(a){return a.name===d.name})},a.isSelected=function(b){return a.providers[b].selected},a.saveProvider=function(b){var c=a.providers[b];c.inProgress=!0,d.saveProvider(c).then(function(a){console.log(a),c.saved=!0,c.inProgress=!1,d.updateProfile({providers:new d.Provider(c.name,c.url)}),console.log(d.getProfile())},function(a){c.inProgress=!1,console.log(a)})},a.removeProvider=function(b){var c=a.providers[b];c.inProgress=!0,d.removeProvider(c).then(function(){c.saved=!1,c.inProgress=!1,d.updateProfile({providers:new d.Provider(c.name,"")}),console.log(d.getProfile())},function(a){c.inProgress=!1,console.log(a)})}}]),a.controller("ApplyInfoCtrl",["$scope","$modal","$timeout","ProfileSvc",function(a,b,c,d){var e=b({scope:a,template:"views/components/modalImageCrop.html",show:!1,animation:"am-slide-top",keyboard:!0});a.personalUrlExists=!1,a.profileImage=d.getProfile().image,a.countries=d.getCountries(),a.personalUrl="",a.title="",a.title="",a.city="",a.country="",a.closeModal=function(){a.init(!1),e.hide()},a.init=function(b){a.uncroppedImage="",a.croppedImage="",a.tempImage="",a.setProgress(b)},a.updateCroppedImage=function(b){a.croppedImage=b},a.showImageCropModal=function(){e.$promise.then(function(){a.croppedImage="",e.show()})},a.onFileSelect=function(b){var d=new FileReader;d.onload=function(b){c(function(){a.uncroppedImage=b.target.result})},d.readAsDataURL(b[0])},a.setProgress=function(b){a.inProgress=b},a.getProfile=function(){return d.getProfile()},a.saveProfileImage=function(){d.saveProfileImage(a.croppedImage).then(function(b){console.log(b),d.updateProfile({image:a.croppedImage}),a.profileImage=angular.copy(a.croppedImage),a.closeModal()},function(a){console.log(a)})},a.savePersonalUrl=function(){d.savePersonalUrl(a.personalUrl).then(function(b){console.log(b),d.updateProfile({personalUrl:a.personalUrl})},function(b){console.log(b),a.personalUrlExists=!0})},a.continue=function(){var b={title:a.title,bio:a.bio,city:a.city,country:a.country};d.saveProfile(b).then(function(a){console.log(a),d.updateProfile(b),console.log(d.getProfile())},function(a){console.log(a)})},a.init()}])}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvSlider",["$document","$timeout",function(a,b){var c=40,d=38;return{restrict:"E",templateUrl:"views/directives/fv-slider.html",link:function(e,f,g){function h(a){b(function(){"up"===e.direction?e.index++:e.index--},l*a)}function i(){return function(a){var b=window.event||a,c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail));return e.$apply(e.goToSlide(0>c?e.index+1:e.index-1)),!1}}function j(a){a.keyCode===c&&e.$apply(function(){e.goToSlide(e.index+1)}),a.keyCode===d&&e.$apply(function(){e.goToSlide(e.index-1)})}var k=600,l=200,m=!1;g.fullscreen&&angular.element("body").css("overflow","hidden"),e.options={fullscreen:g.fullscreen,keyboard:g.keyboard,count:g.count||0,slidename:g.slidename||"slide",indicator:g.indicator,navbtn:g.navbtn},e.slides=[];for(var n=0;n<g.count;n++)e.slides.push(g.slidename+n);e.index=0,e.direction="up",e.speed=800,e.goToSlide=function(a){var c=0;if(!(m||0>a||a===e.slides.length)){m=!0,b(function(){m=!1},1e3,!1),e.direction=e.index>a?"down":"up",c=Math.abs(e.index-a),e.speed=k-(c-1)*l;for(var d=0;c>d;d++)h(d)}},angular.element(a).on("keydown",j),document.addEventListener&&(document.addEventListener("mousewheel",i(),!1),document.addEventListener("DOMMouseScroll",i(),!1)),e.$on("$destroy",function(){g.fullscreen&&angular.element("body").css("overflow","auto"),angular.element(a).off("keydown"),angular.element(a).off("mousewheel"),angular.element(a).off("DOMMouseScroll")})}}}]),a.directive("fvScrollBottom",["$window","$document","$timeout",function(a,b,c){return{restrict:"A",link:function(d,e,f){d.$on(f.scrolltrigger,function(){c(function(){a.scrollTo(0,angular.element(b)[0].body.scrollHeight)})})}}}]),a.directive("fvAutoFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){c&&c.focus&&a(function(){c.focus()})}}}]),a.directive("fvBgImage",function(){return{restrict:"A",link:function(a,b,c){c.$observe("fvBgImage",function(a,c){a&&a!==c&&b.css({"background-image":["url(",a,")"].join(""),"background-size":"cover"})},!0)}}}),a.directive("fvOnDrop",function(){return{restrict:"A",link:function(a,b,c){b.on("drop",function(){a.$apply(c.fvOnDrop)})}}}),a.directive("fvTimelineH",function(){return{restrict:"E",templateUrl:"views/directives/fv-timeline-h.html",link:function(){}}})}(),function(){"use strict";var a=angular.module("fvApp");a.service("SessionSvc",function(){return this.create=function(a,b,c,d){this.id=a,this.userId=b,this.userRole=d},this.destroy=function(){this.id=null,this.userId=null,this.userRole=null},this}),a.service("LocalStorageSvc",function(){return this.getSession=function(){return JSON.parse(localStorage.getItem("firebaseSession"))},this}),a.service("UserSvc",function(){return this.setUser=function(a){localStorage.setItem("user",JSON.stringify(a))},this.getUser=function(){return JSON.parse(localStorage.getItem("user"))},this.removeUser=function(){localStorage.removeItem("user")},this}),a.service("AuthSvc",["$firebaseSimpleLogin","$linkedIn","$cookies","SessionSvc","AUTH_PROVIDER_OPTIONS","ENV",function(a,b,c,d,e,f){var g=e,h=f;return this.isAuthenticated=function(){return!!d.userId},this.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),this.isAuthenticated()&&-1!==a.indexOf(d.userRole)},this.firebaseAuth=function(){return a(new Firebase(h.firebaseUrl))},this.loginLi=function(){return b.authorize()},this.getLiProfile=function(){return b.profile("me",g.linkedIn.fields)},this.getLiCookie=function(){return c[["linkedin_oauth_",h.liApiKey,"_crc"].join("")]},this}]),a.service("ProfileSvc",["$http","$q","$upload","$timeout",function(a,b,c,d){var e=["linkedIn","oDesk","elance","peoplePerHour","freelancer","behance","dribbble","github"],f=["import","info","open"],g="/countries",h=[],i={};!function(){a.get(g).success(function(a){h=a}).error(function(a){h=["Uk","USA","Greece"],console.log(a)})}(),this.Provider=function(a,b){this.name=a,this.url=b},this.initProviders=function(){var a=this,b={};return _.forEach(e,function(c){b[c]=new a.Provider(c,"")}),b},this.getProfile=function(){return i},this.getSteps=function(){return f},this.getCountries=function(){return h},this.updateProfile=function(a){angular.extend(i,a)},this.saveProvider=function(a){var c=b.defer();return d(function(){c.resolve("provider saved: "+a.toString())},2e3),c.promise},this.saveProfileImage=function(a){!a&&console.log("no img");var c=b.defer();return d(function(){c.resolve("profile image saved")}),c.promise},this.savePersonalUrl=function(a){!a&&console.log("no url");var c=b.defer();return d(function(){c.resolve("personal url saved")}),c.promise},this.saveProfile=function(a){!a&&console.log("no info");var c=b.defer();return d(function(){c.resolve("profile info saved")}),c.promise},this.removeProvider=function(a){var c=b.defer();return d(function(){c.resolve("provider removed: "+a.toString())},2e3),c.promise}}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("Utils",function(){var a={};return a.URL_PATTERN=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#!\(\)-]*[\w@?^=%&amp;\/~+#-])?/gim,a.PSEUDO_URL_PATTERN=/(^|[^\/])(www\.[\S]+(\b|$))/gim,a.ELANCE_URL_PATTERN=/^http[s]?:\/\/([^\/]*elance.com)/i,a})}();