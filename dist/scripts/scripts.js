!function(){"use strict";var a=angular.module("fvApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","mgcrea.ngStrap.modal","mgcrea.ngStrap.helpers.dimensions","mgcrea.ngStrap.helpers.parseOptions","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.select","mgcrea.ngStrap.tab","mgcrea.ngStrap.collapse","mgcrea.ngStrap.button","mgcrea.ngStrap.alert","mgcrea.ngStrap.typeahead","config","angularFileUpload","ngImgCrop","duScroll","angular-carousel","ui.validate","breeze.angular","angucomplete","angularMoment"]);a.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/landing.html",controller:"LandingCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegistrationCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/forgotPassword",{templateUrl:"views/forgotPassword.html",controller:"ForgotPwdCtrl"}).when("/resetPassword",{templateUrl:"views/resetPassword.html",controller:"ResetPwdCtrl"}).when("/apply",{templateUrl:"views/apply.html"}).when("/:moniker",{templateUrl:"views/storefront.html",controller:"StorefrontCtrl",resolve:{profile:["$route","$location","$q","ProfileSvc",function(a,b,c,d){var e=c.defer();return d.fetchProfile(a.current.params.moniker).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise}]}}).when("/offers/:offerId",{templateUrl:"views/offer.html",controller:"OfferCtrl",resolve:{offer:["$route","OfferSvc",function(a,b){return b.fetchOffer(a.current.params.offerId)}]}}).otherwise({redirectTo:"/"})}]),a.value("duScrollGreedy",!0),a.config(["$alertProvider","$httpProvider",function(a,b){b.defaults.withCredentials=!0,b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"],b.responseInterceptors.push(["$rootScope","$q","$location","PATHS","MESSAGES","EVENTS",function(a,b,c,d,e,f){return function(e){return e.then(function(a){return a},function(e){return 401===e.status?(console.log(e),e.config.url!==d.account.userInfo&&(a.$broadcast(f.auth.sessionTimeout,e),c.path("/login")),e):b.reject(e)})}}]),angular.extend(a.defaults,{animation:"am-fade-and-slide-top",placement:"top",duration:4,dismissable:!0,template:"views/components/alert.html"})}]),a.run(["breeze",function(a){!a&&console.log("breeze not loaded!")}])}(),function(){"use strict";angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"http://futurvention.herokuapp.com",fbApiKey:"675990215825778",liApiKey:"77xj8xhasosg9k",firebaseUrl:"https://fvapp.firebaseio.com/"})}(),function(){"use strict";var a=angular.module("fvApp");a.constant("EVENTS",{profile:{fetchProfileFailed:"fetch-profile-failed",fetchProfileSuccess:"fetch-profile-success",profileUpdated:"profile-updated"},user:{createSuccess:"user-creation-success",createFailed:"user-creation-failed",updateSuccess:"user-update-success",updateFailed:"user-update-failed"},auth:{registrationSuccess:"auth-registration-success",registrationFailed:"auth-registration-failed",loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"},importer:{profileReady:"imp-profile-ready",portfoliosReady:"imp-portfolios-ready",reviewsReady:"imp-reviews-ready",status:"imp-status"},ui:{providerSelected:"ui-provider-selected",cameraReady:"ui-camera-ready"}}),a.constant("USER_ROLES",{all:"*",admin:"admin",user:"user",guest:"guest"}),a.constant("PATHS",{root:"https://futurventionstage.azurewebsites.net","public":"https://futurventionstage.azurewebsites.net/public.svc/",cached:"https://futurventionstage.azurewebsites.net/CachedPublic.svc/",account:{register:"https://futurventionstage.azurewebsites.net/api/Account/Register",login:"https://futurventionstage.azurewebsites.net/api/Account/Login",logout:"https://futurventionstage.azurewebsites.net/api/Account/Logout",userInfo:"https://futurventionstage.azurewebsites.net/api/Account/UserInfo",resetPassword:"https://futurventionstage.azurewebsites.net/api/Account/ChangePassword",externalLogins:"https://futurventionstage.azurewebsites.net/api/Account/ExternalLogins?returnUrl=http://client.futurvention.com:9000&generateState=true"},importer:{importedData:"https://extservicesdata.blob.core.windows.net:443/crawleddata/","import":"https://futurventionstage.azurewebsites.net/api/ExtService/import",checkProgress:"https://futurventionstage.azurewebsites.net/api/ExtService/checkprogress",fetchProfile:"https://futurventionstage.azurewebsites.net/api/ExtService/getprofiles",fetchPortfolios:"https://futurventionstage.azurewebsites.net/api/ExtService/getportfolios"},sellerManagement:{profile:"https://futurventionstage.azurewebsites.net/api/SellerManagement/Profiles/",ownProfile:"https://futurventionstage.azurewebsites.net/api/SellerManagement/Profiles/OwnProfile",profileStatus:"https://futurventionstage.azurewebsites.net/api/SellerManagement/Profiles/OwnProfile/Status",importedShowcases:"https://futurventionstage.azurewebsites.net/api/SellerManagement/Profiles/OwnProfile/ImportedShowcases?serviceID=",showcases:"https://futurventionstage.azurewebsites.net/api/SellerManagement/SellerProfiles/OwnProfile/SingleItemShowcases?serviceID=",ownReviews:"https://futurventionstage.azurewebsites.net/api/SellerManagement/Profiles/OwnProfile/reviews",monikerExists:function(a){return["https://futurventionstage.azurewebsites.net/api/SellerManagement/Profiles/",a,"/exists"].join("")}},user:{self:"https://futurventionstage.azurewebsites.net/api/Self?expand=Avatar",ownAvatar:"https://futurventionstage.azurewebsites.net/api/Self/Avatar"},file:{hosted:"https://ergmaimages.blob.core.windows.net/userdata/",imported:"https://extservicesdata.blob.core.windows.net:443/crawleddata/"},offerManagement:{ownOffers:"https://futurventionstage.azurewebsites.net/api/OffersManagement/OwnOffers",offeredServices:"https://futurventionstage.azurewebsites.net/api/OffersManagement/OwnOffers?expand=Service/ShortTitle/Literals,Service/ThumbnailFile"}}),a.constant("ROUTES",{"public":["/","/login","/register"]}),a.constant("EMBEDLY",{key:"05b548d0a515404f8f3da52d93eb402f",domain:"http://api.embed.ly/1/",oembedAPI:"oembed"}),a.constant("MESSAGES",{error:{generic:"Something went wrong. Please try again later.",logoutFailed:"Something went wrong. Please try logging out again.",profileImportFailed:"No profiles could be imported",profileSaveFailed:"Something went wrong! Please try saving your profiles again."},success:{createNewPassword:"We sent you an email. Follow the instructions to create a new password.",resetPassword:"Your password has been reset!",profileImported:"Your profile has been imported from "}}),a.constant("IMPORT_PROVIDERS",["linkedin","odesk","elance","pph","freelancer","behance","dribbble","github"]),a.constant("PROVIDERS_ENUM",{behance:1,dribbble:2,elance:3,freelancer:4,github:5,odesk:6,peopleperhour:7}),a.constant("FILE_TYPE_CONFIG",[{ID:1,ContentCode:"image/x-jg",Viewer:"Prizma",Thumbnail:"General"},{ID:2,ContentCode:"video/avs-video",Viewer:"Html5 video",Thumbnail:"General"},{ID:3,ContentCode:"image/bmp",Viewer:"Html5 image",Thumbnail:"General"},{ID:4,ContentCode:"text/csv",Viewer:"Prizma",Thumbnail:"Excel"},{ID:5,ContentCode:"application/x-director",Viewer:"Prizma",Thumbnail:"General"},{ID:6,ContentCode:"video/x-dv",Viewer:"Html5 video",Thumbnail:"General"},{ID:7,ContentCode:"application/msword",Viewer:"Prizma",Thumbnail:"Word"},{ID:8,ContentCode:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",Viewer:"Prizma",Thumbnail:"Word"},{ID:9,ContentCode:"image/vnd.dwg",Viewer:"Prizma",Thumbnail:"General"},{ID:10,ContentCode:"image/vnd.dxf",Viewer:"Prizma",Thumbnail:"General"},{ID:11,ContentCode:"message/rfc822",Viewer:"Prizma",Thumbnail:"General"},{ID:12,ContentCode:"application/postscript",Viewer:"Prizma",Thumbnail:"General"},{ID:13,ContentCode:"video/x-atomic3d-feature",Viewer:"Html5 video",Thumbnail:"General"},{ID:14,ContentCode:"image/g3fax",Viewer:"Prizma",Thumbnail:"General"},{ID:15,ContentCode:"image/gif",Viewer:"Html5 image",Thumbnail:"General"},{ID:16,ContentCode:"text/html",Viewer:"Prizma",Thumbnail:"General"},{ID:17,ContentCode:"image/x-icon",Viewer:"Prizma",Thumbnail:"General"},{ID:18,ContentCode:"image/jpeg",Viewer:"Html5 image",Thumbnail:"General"},{ID:19,ContentCode:"image/vnd.fujixerox.edmics-mmr",Viewer:"Prizma",Thumbnail:"General"},{ID:20,ContentCode:"audio/mpeg3",Viewer:"Html5 audio",Thumbnail:"General"},{ID:21,ContentCode:"application/mp4",Viewer:"Html5 video",Thumbnail:"General"},{ID:22,ContentCode:"application/vnd.mophun.certificate",Viewer:"Prizma",Thumbnail:"General"},{ID:23,ContentCode:"application/vnd.mobius.msl",Viewer:"Prizma",Thumbnail:"General"},{ID:24,ContentCode:"application/vnd.oasis.opendocument.graphics",Viewer:"Prizma",Thumbnail:"General"},{ID:25,ContentCode:"application/vnd.oasis.opendocument.presentation",Viewer:"Prizma",Thumbnail:"General"},{ID:26,ContentCode:"application/vnd.oasis.opendocument.spreadsheet",Viewer:"Prizma",Thumbnail:"Excel"},{ID:27,ContentCode:"application/vnd.oasis.opendocument.text",Viewer:"Prizma",Thumbnail:"Txt"},{ID:28,ContentCode:"application/vnd.oasis.opendocument.graphics-template",Viewer:"Prizma",Thumbnail:"General"},{ID:29,ContentCode:"application/vnd.oasis.opendocument.text-template",Viewer:"Prizma",Thumbnail:"General"},{ID:30,ContentCode:"image/x-pict",Viewer:"Prizma",Thumbnail:"General"},{ID:31,ContentCode:"image/x-pcx",Viewer:"Prizma",Thumbnail:"General"},{ID:32,ContentCode:"application/vnd.palm",Viewer:"Prizma",Thumbnail:"General"},{ID:33,ContentCode:"application/pdf",Viewer:"Prizma",Thumbnail:"PDF"},{ID:34,ContentCode:"application/x-font-type1",Viewer:"Prizma",Thumbnail:"General"},{ID:35,ContentCode:"image/x-portable-graymap",Viewer:"Prizma",Thumbnail:"General"},{ID:36,ContentCode:"image/pict",Viewer:"Prizma",Thumbnail:"General"},{ID:37,ContentCode:"image/png",Viewer:"Html5 image",Thumbnail:"General"},{ID:38,ContentCode:"image/x-portable-anymap",Viewer:"Prizma",Thumbnail:"General"},{ID:39,ContentCode:"image/x-portable-pixmap",Viewer:"Prizma",Thumbnail:"General"},{ID:40,ContentCode:"application/vnd.ms-powerpoint",Viewer:"Prizma",Thumbnail:"PowerPoint"},{ID:41,ContentCode:"application/vnd.openxmlformats-officedocument.presentationml.presentation",Viewer:"Prizma",Thumbnail:"General"},{ID:42,ContentCode:"image/vnd.adobe.photoshop",Viewer:"Prizma",Thumbnail:"General"},{ID:43,ContentCode:"image/x-cmu-raster",Viewer:"Prizma",Thumbnail:"General"},{ID:44,ContentCode:"image/x-rgb",Viewer:"Prizma",Thumbnail:"General"},{ID:45,ContentCode:"application/rtf",Viewer:"Prizma",Thumbnail:"Txt"},{ID:46,ContentCode:"application/vnd.stardivision.draw",Viewer:"Prizma",Thumbnail:"General"},{ID:47,ContentCode:"application/vnd.stardivision.calc",Viewer:"Prizma",Thumbnail:"Excel"},{ID:48,ContentCode:"application/vnd.stardivision.impress",Viewer:"Prizma",Thumbnail:"General"},{ID:49,ContentCode:"application/vnd.stardivision.writer",Viewer:"Prizma",Thumbnail:"General"},{ID:50,ContentCode:"application/vnd.sun.xml.calc.template",Viewer:"Prizma",Thumbnail:"Excel"},{ID:51,ContentCode:"application/vnd.sun.xml.draw.template",Viewer:"Prizma",Thumbnail:"General"},{ID:52,ContentCode:"application/vnd.sun.xml.impress.template",Viewer:"Prizma",Thumbnail:"General"},{ID:53,ContentCode:"application/step",Viewer:"Prizma",Thumbnail:"General"},{ID:54,ContentCode:"application/vnd.sun.xml.writer.template",Viewer:"Prizma",Thumbnail:"General"},{ID:55,ContentCode:"image/svg+xml",Viewer:"Prizma",Thumbnail:"General"},{ID:56,ContentCode:"application/x-shockwave-flash",Viewer:"Html5 video",Thumbnail:"General"},{ID:57,ContentCode:"application/vnd.sun.xml.calc",Viewer:"Prizma",Thumbnail:"Excel"},{ID:58,ContentCode:"application/vnd.sun.xml.draw",Viewer:"Prizma",Thumbnail:"General"},{ID:59,ContentCode:"application/vnd.sun.xml.impress",Viewer:"Prizma",Thumbnail:"General"},{ID:60,ContentCode:"application/vnd.sun.xml.writer",Viewer:"Prizma",Thumbnail:"General"},{ID:61,ContentCode:"image/tiff",Viewer:"Prizma",Thumbnail:"General"},{ID:62,ContentCode:"application/x-font-ttf",Viewer:"Prizma",Thumbnail:"General"},{ID:63,ContentCode:"text/plain",Viewer:"Prizma",Thumbnail:"Txt"},{ID:64,ContentCode:"text/x-uil",Viewer:"Prizma",Thumbnail:"General"},{ID:65,ContentCode:"image/vnd.wap.wbmp",Viewer:"Prizma",Thumbnail:"General"},{ID:66,ContentCode:"application/x-msmetafile",Viewer:"Prizma",Thumbnail:"General"},{ID:67,ContentCode:"image/x-xbitmap",Viewer:"Prizma",Thumbnail:"General"},{ID:68,ContentCode:"application/xhtml+xml",Viewer:"Prizma",Thumbnail:"General"},{ID:69,ContentCode:"application/vnd.ms-excel",Viewer:"Prizma",Thumbnail:"Excel"},{ID:70,ContentCode:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Viewer:"Prizma",Thumbnail:"Excel"},{ID:71,ContentCode:"application/excel",Viewer:"Prizma",Thumbnail:"Excel"},{ID:72,ContentCode:"application/xml",Viewer:"Prizma",Thumbnail:"General"},{ID:73,ContentCode:"image/x-xpixmap",Viewer:"Prizma",Thumbnail:"General"},{ID:74,ContentCode:"image/x-xwindowdump",Viewer:"Prizma",Thumbnail:"General"},{ID:75,ContentCode:"application/prezi",Viewer:"Prizma",Thumbnail:"General"}])}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvSlider",["$document","$timeout",function(a,b){var c=40,d=38;return{restrict:"E",templateUrl:"views/directives/fv-slider.html",link:function(e,f,g){function h(a){b(function(){"up"===e.direction?e.index++:e.index--},l*a)}function i(){return function(a){var b=window.event||a,c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail));return e.$apply(e.goToSlide(0>c?e.index+1:e.index-1)),!1}}function j(a){a.keyCode===c&&e.$apply(function(){e.goToSlide(e.index+1)}),a.keyCode===d&&e.$apply(function(){e.goToSlide(e.index-1)})}var k=600,l=200,m=!1;g.fullscreen&&angular.element("body").css("overflow","hidden"),e.options={fullscreen:g.fullscreen,keyboard:g.keyboard,count:g.count||0,slidename:g.slidename||"slide",indicator:g.indicator,navbtn:g.navbtn},e.slides=[];for(var n=0;n<g.count;n++)e.slides.push(g.slidename+n);e.index=0,e.direction="up",e.speed=800,e.goToSlide=function(a){var c=0;if(!(m||0>a||a===e.slides.length)){m=!0,b(function(){m=!1},1e3,!1),e.direction=e.index>a?"down":"up",c=Math.abs(e.index-a),e.speed=k-(c-1)*l;for(var d=0;c>d;d++)h(d)}},angular.element(a).on("keydown",j),document.addEventListener&&(document.addEventListener("mousewheel",i(),!1),document.addEventListener("DOMMouseScroll",i(),!1)),e.$on("$destroy",function(){g.fullscreen&&angular.element("body").css("overflow","auto"),angular.element(a).off("keydown"),angular.element(a).off("mousewheel"),angular.element(a).off("DOMMouseScroll")})}}}]),a.directive("fvScrollBottom",["$window","$document","$timeout",function(a,b,c){return{restrict:"A",link:function(d,e,f){d.$on(f.scrolltrigger,function(){c(function(){a.scrollTo(0,angular.element(b)[0].body.scrollHeight)})})}}}]),a.directive("fvScrollTo",["$document","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){b(e.fvScrollTo&&a.scrollToElement(d))}}}]),a.directive("fvAutoFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){c&&c.focus&&a(function(){c.focus()})}}}]),a.directive("fvFocusInput",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){a(function(){var b=document.getElementsByName(d.focusInput)[0];b&&c.on(d.focusOn,function(){a(function(){b.focus()})})})}}}]),a.directive("fvBgImage",function(){return{restrict:"A",link:function(a,b,c){c.$observe("fvBgImage",function(a,c){a&&a!==c&&b.css("background-image",['url("',a,'")'].join(""))},!0)}}}),a.directive("fvDraggable",function(){return function(a,b,c){var d=b[0];return c.fvDraggable===!1?void d.removeAttr("draggable"):(d.draggable=!0,void d.addEventListener("dragstart",function(a){return a.dataTransfer.effectAllowed="move",c.fvData&&a.dataTransfer.setData("Text",JSON.stringify(c.fvData)),!1},!1))}}),a.directive("fvDroppable",function(){return{scope:{},link:function(a,b,c){var d=b[0];c.fvDropClass&&d.addEventListener("dragenter",function(){return this.classList.add(c.fvDropClass),!1},!1),c.fvDropClass&&d.addEventListener("dragleave",function(){return this.classList.remove(c.fvDropClass),!1},!1),d.addEventListener("dragover",function(a){return a.preventDefault&&a.preventDefault(),a.dataTransfer.dropEffect="move",!1},!1),d.addEventListener("drop",function(a){return a.stopPropagation&&a.stopPropagation(),c.fvDropClass&&this.classList.remove(c.fvDropClass),!1},!1)}}}),a.directive("fvOnDrop",function(){return{restrict:"A",link:function(a,b,c){b[0].addEventListener("drop",function(b){a.$apply(_.bind(a[c.fvOnDrop],{event:b},a.item))})}}}),a.directive("fvTimelineH",function(){return{restrict:"E",templateUrl:"views/directives/fv-timeline-h.html",link:function(){}}}),a.directive("fvDynamicName",["$compile","$parse",function(a,b){return{restrict:"A",terminal:!0,priority:1e5,link:function(c,d){var e=b(d.attr("fv-dynamic-name"))(c);d.removeAttr("fv-dynamic-name"),d.attr("name",["input","-",e].join("")),a(d)(c)}}}]),a.directive("fvToggleClass",function(){return function(a,b,c){c.fvOn&&c.fvClass&&b[0].addEventListener(c.fvOn,function(){this.classList.toggle(c.fvClass)})}}),a.directive("fvTabs",function(){return function(a,b){var c=_.filter(b.children(),function(a){return a.hasAttribute("fv-pane")});_.forEach(c,function(b,c){b.addEventListener("click",function(){a.$emit("pane-clicked",c)})}),a.$on("pane-clicked",function(a,b){_.forEach(c,function(a,c){b===c?angular.element(a).addClass("active"):angular.element(a).removeClass("active")})})}}),a.directive("fvCameraTag",["EVENTS",function(a){return{scope:{fvCameraTag:"@"},link:function(b){b.$emit(a.ui.cameraReady)}}}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("MessagingSvc",["$http","$q","$timeout",function(a,b,c){var d={};return d.sendMessage=function(a,d,e,f,g){console.log(g);var h=b.defer();return c(function(){h.resolve(g)}),h.promise},d}]),a.service("NotificationSvc",["$http","$q","$alert",function(a,b,c){var d={};return d.show=function(a){var d=c(a),e=b.defer();return e.resolve(d),e.promise},d}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("Enum",function(){var a={};return a.OfferStatus=Object.freeze({AUDIO:"audio",IMAGE:"image",INLINE_TEXT:"inline_text",TEXT:"text",VIDEO:"video"}),a.ShowcaseFileType=Object.freeze({LINKED:"linked",HOSTED:"hosted"}),a.Providers=Object.freeze({LINKEDIN:"linkedIn",ODESK:"oDesk",ELANCE:"elance",PPH:"pph",FREELANCER:"freelancer",BEHANCE:"behance",DRIBBBLE:"dribbble",GITHUB:"github"}),a})}(),function(){"use strict";var a=angular.module("fvApp");a.service("Utils",function(){var a={};return a.updateProperties=function(a,b){return b&&_.forOwn(a,function(c,d){b.hasOwnProperty(d)&&(a[d]=b[d])}),a},a.removeEmptyProperties=function(a){var b,c,d;return _.pick(a,function(a){return b=typeof a===Number&&0===a,c=null===a,d=a instanceof Array&&0===a.length,!b&&!c&&!d})},a.getCameraTagUuid=function(a){return a.replace("http://cameratag.com/videos/","").replace("/qvga/mp4.mp4","")},a.capitalize=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},a.capitalizeKeys=function(b){var c={},d=_.values(b);return _.each(_.keys(b),function(b,e){c[a.capitalize(b)]=d[e]}),c},a.camelCaseKeys=function(b){if(_.isObject(b)){var c={},d=_.values(b);return _.each(_.keys(b),function(e,f){/[a-z]/.test(e)?c[e.charAt(0).toLowerCase()+e.slice(1)]=_.isObject(b[e])?a.camelCaseKeys(d[f]):d[f]:c[e]=d[f]}),c}},a.base64toBlob=function(a,b){b=b||"";for(var c=1024,d=atob(a),e=d.length,f=Math.ceil(e/c),g=new Array(f),h=0;f>h;++h){for(var i=h*c,j=Math.min(i+c,e),k=new Array(j-i),l=i,m=0;j>l;++m,++l)k[m]=d[l].charCodeAt(0);g[h]=new Uint8Array(k)}return new Blob(g,{type:b})},a.URL_PATTERN=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#!\(\)-]*[\w@?^=%&amp;\/~+#-])?/gim,a.PSEUDO_URL_PATTERN=/(^|[^\/])(www\.[\S]+(\b|$))/gim,a.ELANCE_URL_PATTERN=/^http[s]?:\/\/([^\/]*elance.com)/i,a.isVideo=function(a){var b=new RegExp(/video\/*/g);return b.test(a)},a.getUrlParams=function(a){var b,c;if(a){for(var d=0;d<a.length;++d)c=a[d].split("=",2),b[c[0]]=1===c.length?"":decodeURIComponent(c[1].replace(/\+/g," "));return b}},a.testEmailPattern=function(a){return/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/im.test(a)},a.removeParenthesis=function(a){return a&&"string"==typeof a?a.replace(/ *\([^)]*\) */g,""):a},a}),Array.prototype.hasOwnProperty("swap")||(Array.prototype.swap=function(a,b){var c=this[a];return this[a]=this[b],this[b]=c,this}),Array.prototype.hasOwnProperty("empty")||(Array.prototype.empty=function(){for(;this.length>0;)this.pop()}),Array.prototype.hasOwnProperty("remove")||(Array.prototype.remove=function(a){if("function"!=typeof a)return void 0;for(var b=0;b<this.length;b++)if(a(this[b]))return this.splice(b,1);return void 0}),Array.prototype.hasOwnProperty("merge")||(Array.prototype.merge=function(a){if(!(a instanceof Array))return void 0;for(var b=0;b<a.length;b++)this.push(a[b]);return this}),Function.prototype.hasOwnProperty("method")||(Function.prototype.method=function(a,b){return this.prototype[a]=b,this}),Function.prototype.hasOwnProperty("inherits")||Function.method("inherits",function(a){return this.prototype=new a,this.prototype.constructor=parent,this}),Function.prototype.hasOwnProperty("inheritFunctions")||(Function.prototype.inheritFunctions=function(a,b){if(a&&b&&a instanceof Object&&b instanceof Array){for(var c,d=this,e=0;e<b.length;e++)c=b[e],a.hasOwnProperty(c)&&a[c]instanceof Function&&(d.prototype[c]=a[c]);return d}})}(),function(){"use strict";var a=angular.module("fvApp");a.filter("trusted",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]),a.filter("prizmUrl",function(){return function(a){return["http://connect.ajaxdocumentviewer.com/?key=K4102014161530&viewertype=html5&document=",a,"&viewerheight=100%&viewerwidth=100%&printButton=Yes&toolbarColor=CCCCCC"].join("")}}),a.filter("initial",function(){return function(a){return a.charAt(0).concat(".")}})}(),function(){"use strict";var a=angular.module("fvApp");a.factory("Odata",["PROVIDERS_ENUM","PATHS","Utils",function(a,b,c){var d={},e={};return e.setMultilingual=function(a,b){var c=this;switch(!0){case!b||!c.hasOwnProperty(a):break;case null===c[a]:c[a]=new d.Multilingual({Literals:[new d.Literal({Text:b})]});break;case c[a]instanceof d.Multilingual:c[a].Literals[0].Text=b}return c},e.multilingualToString=function(a){return a&&-1!==_.keys(this,a).indexOf(a)?this[a].Literals[0].Text:void 0},d.Literal=function(a){var b=this;b.ID=0,b.Text=null,b.LanguageID=1,b.IsDefault=!0,c.updateProperties(b,a)},d.Multilingual=function(a){var b=this;b.ID=0,b.Literals=[new d.Literal],c.updateProperties(b,a)},d.Location=function(a){var b=this;b.ID=0,b.ParentID=0,b.Name=null,c.updateProperties(b,a)},d.Location.method("getName",function(){return this.multilingualToString("Name")}),d.Location.inheritFunctions(e,["setMultilingual","multilingualToString"]),d.SellerProfile=function(a){var b=this;b.ID=0,b.Moniker=null,b.FirstName=null,b.LastName=null,b.Title=new d.Multilingual,b.Description=new d.Multilingual,b.Resume=null,b.Status=null,b.Location=null,b.LocationID=0,b.Showcases=[],b.Reviews=[],c.updateProperties(b,a)},d.SellerProfile.prototype.fromImported=function(a){if(a){var b=this;return c.updateProperties(b,{FirstName:a.FirstName,LastName:a.LastName,Description:new d.Multilingual({Literals:[new d.Literal({Text:a.Bio})]}),Title:new d.Multilingual({Literals:[new d.Literal({Text:a.Headline})]})}),b}},d.SellerProfile.prototype.getCity=function(){return c.removeParenthesis(new d.Location(this.Location).multilingualToString("Name"))},d.SellerProfile.inheritFunctions(e,["setMultilingual","multilingualToString"]),d.User=function(a){var b=this;b.ID=0,b.Guid="",b.Avatar=null,b.AvatarID=0,b.IsSystem=!1,b.IsAnonymous=!1,b.FirstName=null,b.LastName=null,b.PreferredLanguageID=1,b.Registrations=[],b.Roles=[],c.updateProperties(b,a)},d.File=function(a){var b=this;b.FileType=null,b.FileTypeID=null,b.Name=null,b.OwnerID=0,c.updateProperties(b,a)},d.FileType=function(a){var b=this;b.ID=0,b.Name=0,b.AllowedInServiceFields=[],b.AllowedInServices=[],b.MediumCategory=0,b.MimeTypes=0,c.updateProperties(b,a)},d.Showcase=function(a){var b=this;b.ID=0,b.Description=null,b.Title=null,b.Items=[],b.Offers=[],b.Order=0,b.SellerProfileID=0,b.SourceID=0,c.updateProperties(b,a)},d.Showcase.prototype.fromImported=function(a){if(a){var b=this;return c.updateProperties(b,{Description:a.Description?new d.Multilingual({Literals:[new d.Literal({Text:a.Description})]}):null,Title:new d.Multilingual({Literals:[new d.Literal({Text:a.Description})]}),Items:[(new d.ShowcaseItem).fromImported(a)]}),b}},d.ShowcaseItem=function(a){var b=this;b.ID=0,b.Description=null,b.Title=null,b.Order=0,b.ShowcaseID=0,b.Showcase=null,b.FileID=0,b.File=null,b.ThumbnailID=0,b.Thumbnail=null,c.updateProperties(b,a)},d.ShowcaseItem.prototype.fromImported=function(a,b){if(a){var e=this;return c.updateProperties(e,{Description:a.Description?new d.Multilingual({Literals:[new d.Literal({Text:a.Description})]}):null,Title:new d.Multilingual({Literals:[new d.Literal({Text:a.Description})]}),File:(new d.File).fromImported(a),Thumbnail:(new d.File).fromImported(a,"thumbnail"),Showcase:b?b:null}),e}},d.ShowcaseItem.prototype.toSimpleShowcaseItem=function(a){var b=this;return c.updateProperties(new d.SimpleShowcaseItem({ID:b.ID,name:b.Title&&b.Title.Literals[0].Text,link:b.getThumbnail(),file:b.File}),a)},d.ShowcaseItem.prototype.getThumbnail=function(){return this.Thumbnail?this.Thumbnail.hasOwnProperty("Url")?this.Thumbnail.Url:b.file.hosted+this.Thumbnail.RelativeUrl:"images/thumb.png"},d.ShowcaseItem.prototype.getFileLink=function(){return this.File.hasOwnProperty("Url")?this.File.Url:b.file.hosted+this.File.RelativeUrl},d.SimpleShowcaseItem=function(a){var b=this;b.ID=0,b.name="",b.link="",b.state="loading",c.updateProperties(b,a)},d.OfferField=function(a){var b=this;b.ID=0,b.OfferID=0,c.updateProperties(b,a)},d.OfferedChoice=function(a){var b=this;b.ID=0,b.OfferID=0,b.Days=0,b.Price=0,b.ServiceChoiceID=0,b.ServiceChoice={},c.updateProperties(b,a)},d}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("MainCtrl",["$scope","$location","$q","$cookies","$timeout","EVENTS","MESSAGES","ROUTES","PATHS","Utils","Odata","AccountSvc","NotificationSvc","ProfileSvc","UserSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.currentUser={},a.avatar={},a.session={},a.updateCurrentUser=function(b){angular.extend(a.currentUser,b)},a.go=function(a){var d=c.defer();return b.path(a),d.resolve(),d.promise},a.locationAt=function(a){return a===b.path()},a.handleSignIn=function(){l.getUserInfo().then(function(b){a.session=b,a.go(a.locationAt("/register")?"/apply":"/")},function(a){console.log(a),m.show({content:g.error.generic,type:"error"})})},a.$on("$routeChangeStart",function(b,c){!a.session.hasRegistered&&-1===h["public"].indexOf(c.originalPath)&&a.go("/")}),a.$on("$routeChangeError",function(b,c,d,e){console.log(e),m.show({content:g.error.generic,type:"error"}),a.go("/")}),a.$on(f.auth.loginSuccess,function(){a.handleSignIn()}),a.$on(f.auth.registrationSuccess,function(){a.handleSignIn()}),a.$on(f.auth.logoutSuccess,function(){a.session={},a.go("/")}),a.$on(f.auth.logoutFailed,function(){m.show({content:g.error.logoutFailed,type:"error"})}),a.$on(f.user.updateSuccess,function(b,c){a.currentUser=c,a.avatar=c&&c.Avatar?encodeURI(i.file.hosted+c.Avatar.RelativeUrl):null,n.fetchOwnProfile().then(function(b){a.currentUser.Profile=b,a.$broadcast(f.profile.fetchProfileSuccess)})}),a.$watch("session",function(b,c){switch(!0){case b===c:return;case _.isEmpty(b):a.currentUser={};break;default:o.fetchOwnUser()}}),b.search().error&&a.go("/login").then(function(){b.url(b.path()),m.show({content:b.search().error,type:"error"})}),l.getUserInfo().then(function(b){a.session=b},function(a){console.log(a)})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("RegistrationCtrl",["$scope","$rootScope","EVENTS","Utils","AccountSvc",function(a,b,c,d,e){a.newUser={firstName:"",lastName:"",email:"",password:""},a.authError={email:[],password:[]},a.register=function(d){return d?void e.externalLogin(d):void e.register(a.newUser).then(function(){b.$broadcast(c.auth.registrationSuccess)},function(a){console.log(a)})},a.isEmail=function(a){return d.testEmailPattern(a)},a.hasDigits=function(a){return/\d+/g.test(a)},a.hasNonAlphanumeric=function(a){return/\W/g.test(a)},a.hasLowercase=function(a){return/[a-z]/.test(a)},a.hasUppercase=function(a){return/[A-Z]/.test(a)},a.$on(c.auth.registrationFailed,function(b,c){switch(c.status){case"EMAIL_TAKEN":a.authError.emailTaken=a.newUser.email;break;case"INVALID_EMAIL":a.authError.invalidEmail=a.newUser.email;break;default:console.log(b,c)}})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("LoginCtrl",["$scope","$rootScope","EVENTS","MESSAGES","Utils","AccountSvc","NotificationSvc",function(a,b,c,d,e,f,g){a.newUser={email:"",password:""},a.authError={credentials:!1},a.clearAuthError=function(){a.authError.credentials=!1},a.login=function(e){return e?void f.externalLogin(e):void f.login(a.newUser).then(function(){b.$broadcast(c.auth.loginSuccess,event)},function(b){switch(console.log(b),b.status){case 401:a.authError.credentials=!0;break;default:console.log(event,b),g.show({content:d.error.generic,type:"error"})}})},a.isEmail=function(a){return e.testEmailPattern(a)},a.hasDigits=function(a){return/\d+/g.test(a)},a.hasNonAlphanumeric=function(a){return/\W/g.test(a)},a.hasLowercase=function(a){return/[a-z]/.test(a)},a.hasUppercase=function(a){return/[A-Z]/.test(a)}}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("StorefrontCtrl",["$scope","$modal","$timeout","$location","EVENTS","MESSAGES","Odata","ProfileSvc","PortfolioSvc","OfferSvc","MessagingSvc","NotificationSvc","ReviewSvc","UserSvc","profile",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=b({scope:a,template:"views/components/modalContactUser.html",show:!1,animation:"am-slide-top",keyboard:!1}),q=b({scope:a,template:"views/components/modalPortfolioViewer.html",show:!1,animation:"am-slide-top",keyboard:!1}),r=b({scope:a,template:"views/components/modalImageCrop.html",show:!1,animation:"am-slide-top",keyboard:!0});a.user={},a.showcaseItems=[],a.profile=o,a.isCurrentUser=a.currentUser.ID===a.profile.ID,a.reviews={},a.offers=[],a.message="",a.sender={firstName:"",lastName:"",email:""},a.steps=h.getSteps(),a.activeStep=a.steps[4],a.range=function(a){return _.range(0,a)},a.contactUser=function(){k.sendMessage(a.profile.ID,a.currentUser.id,a.sender.firstName,a.sender.lastName,a.message).then(function(){l.show({content:"Your message was successfuly sent!",type:"success"}).then(function(){c(a.closeContactModal)})},function(a){console.log(a)})},a.editProfileSection=function(b){h.setActiveStep(b),a.go("/apply")},a.removeOffer=function(b){j.removeOwnOffer(b.ID).then(function(){_.remove(a.offers,function(a){return a===b})},function(a){console.log(a),l.show({content:f.error.generic,type:"error"})})},a.editOffer=function(b){j.fetchOwnOffer(b.Service.ID).then(function(){a.editProfileSection("offer_config")},function(a){console.log(a),l.show({content:f.error.generic,type:"error"})})},a.showContactModal=function(){p.$promise.then(p.show)},a.closeContactModal=function(){p.$promise.then(p.hide)},a.showPortfolioViewerModal=function(b){a.showcaseIndex=b,q.$promise.then(q.show)},a.showImageCropModal=function(){a.isCurrentUser&&r.$promise.then(function(){a.croppedImage="",r.show()})},a.$on(e.profile.profileUpdated,function(){a.profile.image=h.getProfile().image}),j.fetchOffers(a.profile.ID).then(function(b){a.offers=b},function(a){console.log(a)}),a.isCurrentUser?a.user=a.currentUser:n.fetchUser(a.profile.ID).then(function(b){a.user=b},function(a){console.log(a)}),m.fetchReviews(a.profile.ID).then(function(b){a.reviews=b},function(a){console.log(a)}),i.fetchPortfolio(a.profile.ID).then(function(b){var c;
_.each(b,function(b){c=new g.ShowcaseItem(b.Items[0]),a.showcaseItems.push(c.toSimpleShowcaseItem({state:"loaded"}))}),i.setPortfolio(b)})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ServiceSelectCtrl",["$scope","$timeout","EVENTS","MESSAGES","CatalogueSvc","OfferSvc","NotificationSvc",function(a,b,c,d,e,f,g){a.offset=0,a.batch=e.batch,a.offers=[],a.services=[],a.categories=[],a.allServices=[],a.selectedService={},a.offeredServices=[],a.getServices=function(){e.getServices(a.offset).then(function(b){a.services.merge(b),a.services.totalCount=b.length,a.allServices=e.services},function(a){console.log(a)})},a.getServicesUnderCategory=function(b){e.getServicesUnderCategory(b,a.offset).then(function(b){a.services.merge(b.services),a.services.totalCount=b.totalCount},function(a){console.log(a)})},a.showMore=function(){a.offset+=a.batch;var b=a.categories[a.categories.activeCategoryIndex].categoryID;null===b?a.getServices():a.getServicesUnderCategory(b)},e.getRootCategories().then(function(b){a.categories=b,a.categories.activeCategoryIndex=0},function(a){console.log(a)}),a.removeOffer=function(b){f.removeOwnOffer(b.ID).then(function(){_.remove(a.offers,function(a){return a===b})},function(a){console.log(a),g.show({content:d.error.generic,type:"error"})})},a.editOffer=function(b){f.fetchOwnOffer(b).then(function(){a.goToStep(3)},function(){g.show({content:d.error.generic,type:"error"})})},a.$watch("categories.activeCategoryIndex",function(b,c){switch(!0){case void 0===typeof b||b===c||0===a.categories.length:break;case 0===b:a.offset=0,a.services.empty(),a.getServices();break;default:a.offset=0,a.services.empty(),a.getServicesUnderCategory(a.categories[b].categoryID)}}),a.$watch("selectedService.serviceID",function(b){b&&f.fetchOwnOffer(b).then(function(){a.goToStep(3)},function(){g.show({content:d.error.generic,type:"error"})})}),f.fetchOfferedServices(a.currentUser.ID).then(function(b){a.offers=b})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("OfferConfigCtrl",["$scope","$timeout","$modal","$upload","$location","$q","EVENTS","PROVIDERS_ENUM","PATHS","MESSAGES","Utils","Odata","CatalogueSvc","ProfileSvc","OfferSvc","PortfolioSvc","NotificationSvc","ImporterSvc",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t;a.deadlines=["1 day","2 days","3 days","4 days","5 days","6 days","7 days","8 days","9 days","10 days"],a.extraDeadlines=["1 extra day","2 extra days","3 extra days","4 extra days","5 extra days","6 extra days","7 extra days","8 extra days","9 extra days","10 extra days"],a.urlsToEmbed=[{url:""}],a.offer=o.getOffer(),a.showcaseItems=[],a.showcaseCollection=[],a.service={},a.priceDiscriminators=[],a.addons=[],a.fieldDictionary=[],a.importedPortfolios=[],a.selectedPortfolios=[],a.portfoliosExpanded=[],a.status={},a.activeWorkSamples="owned",a.panels=[{title:"Service Description",state:"default"},{title:"Work Samples",state:"default"},{title:"Personalize your offering",state:"default",textonly:!1},{title:"Pricing / Deadlines",state:"default"}],a.panels.activePanel=0,a.setPanelState=function(a,b){a.state=b},a.closePanel=function(b){switch(b.title){case"Work Samples":a.offer.Showcases=a.showcaseCollection,p.saveShowcases(a.offer.ID,_.map(a.showcaseCollection,function(a){return a.ID})).then(function(a){console.log(a)},function(a){console.log(a)});break;case"Personalize your offering":a.saveOfferField(a.service.interview,a.service.interview.answer),a.service.fields.length>0&&a.saveOfferField(a.service.fields[0],a.service.fields[0].answer)}a.setPanelState(b,"done"),a.panels.activePanel=a.panels.indexOf(_.find(a.panels,function(a){return"default"===a.state}))},s=c({scope:a,template:"views/components/modalEmbedUrl.html",show:!1,keyboard:!1,animation:"am-slide-top"}),t=c({scope:a,template:"views/components/modalCameraTag.html",show:!1,keyboard:!1,backdrop:"static",animation:"am-slide-top"}),a.showEmbedUrlModal=_.throttle(function(){s.$promise.then(function(){s.show()})},700),a.showCameraTagModal=function(){t.$promise.then(function(){t.show()})},a.closeEmbedUrlModal=function(){a.urlsToEmbed.empty=[""],s.hide()},a.closeCameraTagModal=function(){var a=f.defer();return t.$promise.then(function(){t.hide(),a.resolve()}),a.promise},a.rearangeShowcaseItems=function(b){var c,d,e,f,g=JSON.parse(this.event.dataTransfer.getData("Text")),h=b.link;g!==h&&(c=a.showcaseItems.indexOf(_.where(a.showcaseItems,{link:g})[0]),d=a.showcaseItems.indexOf(_.where(a.showcaseItems,{link:h})[0]),a.showcaseItems=a.showcaseItems.swap(c,d),e=a.showcaseCollection.indexOf(_.find(a.showcaseCollection,function(b){return b.Items[0].ID===a.showcaseItems[c].ID})),f=a.showcaseCollection.indexOf(_.find(a.showcaseCollection,function(b){return b.Items[0].ID===a.showcaseItems[d].ID})),a.showcaseCollection=a.showcaseCollection.swap(e,f))},a.togglePortfolioSelection=function(b){var c=a.selectedPortfolios;-1===c.indexOf(b)?c.push(b):c.remove(function(a){return a===b})},a.toggleTextOnly=function(){var b=a.panels[a.panels.activePanel];b.hasOwnProperty("textonly")&&(b.textonly=!b.textonly)},a.getPortfolioCompletionState=function(b){return _.find(a.status,function(a){return a.Provider===h[b]})},a.portfolioDone=function(b){var c=a.getPortfolioCompletionState(b);return c?c.Portfolio.Total===c.Portfolio.Count:!0},a.portfolioImporting=function(b){var c=a.getPortfolioCompletionState(b);return c?c.Portfolio.Total>c.Portfolio.Count:!1},a.getPortfoliosCount=function(b){var c=a.getPortfolioCompletionState(b),d=_.find(a.importedPortfolios,function(a){return a.Provider===b});return c?c.Portfolio.Count:d.data.length},a.toggleActiveWorkSamples=function(){a.activeWorkSamples="owned"===a.activeWorkSamples?"imported":"owned"},a.getImportedLink=function(b){return[i.file.imported,a.currentUser.Guid,"/",b.Provider,"/",b.FolderName,"/",b.ThumbnailAsset.Folder,"/",b.ThumbnailAsset.Name].join("")},a.toggleExpansion=function(b){var c=a.portfoliosExpanded;-1===c.indexOf(b)?c.push(b):c.remove(function(a){return a===b})},a.updateShowcaseItems=function(b){var c,d;_.each(b,function(b){c=new l.Showcase(b),d=new l.ShowcaseItem(c.Items[0]),a.showcaseCollection.push(c),a.showcaseItems.push(d.toSimpleShowcaseItem({state:"loaded"}))})},a.fetchImportedPortfolios=function(){r.fetchPortfolios().then(function(b){a.importedPortfolios=b.data},function(a){console.log(a)})},a.saveImportedPortfolios=function(){return 0===a.selectedPortfolios.length?void a.toggleActiveWorkSamples():void r.saveImportedPortfolios(a.service.serviceID,a.selectedPortfolios).then(function(b){a.updateShowcaseItems(b.data),a.toggleActiveWorkSamples()},function(a){console.log(a),q.show({content:j.error.profileSaveFailed,type:"error"})})},a.onFileSelect=function(b){var c=[];_.each(b,function(a){c.push(a.name)}),d.upload({url:i.sellerManagement.showcases+a.service.serviceID,file:b,fileFormDataName:c}).then(function(b){a.updateShowcaseItems(b.data)},function(a){console.log(a),q.show({content:j.error.generic,type:"error"})})},a.saveUrls=function(){var b=[];_.each(a.urlsToEmbed,function(a){a.url&&b.push(a.url)}),s.hide(),p.saveUrls(b,a.service.serviceID).then(function(b){a.updateShowcaseItems(b.data)},function(a){console.log(a),"Futurvention.Ergma.Business.InvalidFileTypeException"===a.data.ExceptionType&&q.show({content:a.data.ExceptionMessage,type:"error"})})},a.saveOfferField=function(b,c){c&&c.length&&o.saveOfferField(a.offer.ID,b.ID,c).then(function(a){console.log(a)},function(a){console.log(a)})},a.saveOfferedChoice=function(b){b.price>0&&o.saveOfferChoice({offerID:a.offer.ID,serviceChoiceID:b.ID,price:b.price,days:parseInt(b.days)}).then(function(a){console.log(a)})},a.fetchShowcases=function(){p.fetchShowcases(a.offer.ID).then(function(a){console.log(a)},function(a){console.log(a)})},a.saveInterviewVideo=function(b,c){o.saveInterviewVideo(a.offer.ID,a.service.interview.ID,b,c).then(function(){a.service.interview.videoUuid=k.getCameraTagUuid(b),a.service.interview.videoUrl=b},function(a){console.log(a),q.show({content:j.error.generic,type:"error"})})},a.$watch("panels.activePanel",function(){var b=_.find(a.panels,function(a){return"done"!==a.state});!b&&a.goToStep(2)}),a.$on(g.importer.status,function(b,c){a.status!==c&&(a.status=c.data,a.fetchImportedPortfolios())}),a.$on("modal.show",function(){CameraTag&&(CameraTag.setup(),CameraTag.observe("fvcam","processed",function(){var b=CameraTag.cameras.fvcam,c=b.getVideo(),d="http:"+c.formats.qvga.mp4_url,e="http:"+c.formats.qvga.thumb_url;a.closeCameraTagModal().then(function(){_.throttle(function(){a.saveInterviewVideo(d,e)},3e3)})}))}),m.getService(a.offer.ServiceID,!0).then(function(b){var c;a.service=b,_.each(b.options,function(b){_.each(b.choices,function(d){c=_.find(a.offer.OfferedChoices,function(a){return a.ServiceChoiceID===d.ID}),b.isPriceDiscriminator&&(d.price=c?c.Price:0),b.isDaysDiscriminator&&(d.days=c?c.Days:1)}),b.isPriceDiscriminator&&b.isMandatory&&a.priceDiscriminators.push(b),b.isPriceDiscriminator&&!b.isMandatory&&a.addons.push(b)}),_.each(a.offer.Fields,function(c){c.ServiceFieldID===b.interview.ID?a.service.interview.answer=c.Text.Literals[0].Text:a.service.fields[0].answer=c.Text.Literals[0].Text}),o.fetchOffer(a.offer.ID).then(function(b){a.offer.Fields=b.Fields,b.Fields[0]&&b.Fields[0].File&&b.Fields[0].File.Url&&(a.service.interview.videoUuid=k.getCameraTagUuid(b.Fields[0].File.Url),a.service.interview.videoUrl=b.Fields[0].File.Url,CameraTag.setup())})},function(a){console.log(a)}),b(function(){a.panels.activePanel=0}),r.fetchCachedPortfolios(a.currentUser.Guid).then(function(b){a.importedPortfolios=_.pick(b.data,function(a){return a.data&&a.data.length>0})},function(a){console.log(a)}),p.fetchShowcases(a.offer.ID).then(function(b){a.offer.Showcases=b,a.updateShowcaseItems(a.offer.Showcases)})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ApplyCtrl",["$scope","EVENTS","ProfileSvc","ImporterSvc",function(a,b,c,d){a.steps=c.getSteps(),a.activeStep=c.getActiveStep(),a.goToStep=function(b){a.activeStep=a.steps[b],c.setActiveStep(a.activeStep)},a.$on(b.importer.reviewsReady,function(){d.saveReviews(a.currentUser.Guid).then(function(a){console.log(a)},function(a){console.log(a)})}),a.goToStep(a.steps.indexOf(a.activeStep))}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ApplyInfoCtrl",["$scope","$modal","$timeout","EVENTS","Utils","Odata","ProfileSvc","LocationSvc","ImporterSvc","NotificationSvc",function(a,b,c,d,e,f,g,h,i,j){var k=b({scope:a,template:"views/components/modalImageCrop.html",show:!1,animation:"am-slide-top",keyboard:!0});a.profile=g.getProfile(),a.profileExists=!1,a.showImageCropModal=function(){k.$promise.then(function(){a.croppedImage="",k.show()})},a.monikerIsValid=!1,a.city={},a.cities=[],a.cityName="",a.cityNames=[],a.countries=[],a.countryName="",a.countryNames=[],a.validateMoniker=function(){g.validateMoniker(a.profile.Moniker).then(function(b){a.monikerIsValid=!b.data},function(a){console.log(a)})},a["continue"]=function(){switch(!0){case a.profileInfoForm.$pristine:break;case a.profileExists:g.patchProfile(e.removeEmptyProperties(a.profile),a.profile.ID).then(function(a){console.log(a)},function(a){console.log(a)});break;default:g.createProfile(e.removeEmptyProperties(a.profile)).then(function(a){console.log(a)},function(a){console.log(a)})}a.goToStep(2)},a.searchCity=_.throttle(function(b){b&&h.searchCity(a.country.ID,b).then(function(b){c(function(){a.cities=b,a.cityNames=_.map(b,function(a){return a.getName()})})},function(a){console.log(a)})},700),a.hasNonAlphanumeric=function(a){return/\W/g.test(a)},a.$watch("profile",function(b,c){b&&b!==c&&(a.countryName=_.find(a.countries,function(b){return b.ID===a.profile.LocationID}).getName())}),a.$watch("cityName",function(b,c){b&&b!==c&&(a.city=_.find(a.cities,function(b){return b.getName()===a.cityName}),a.profile.LocationID=a.city&&a.city.ID)}),a.$watch("countryName",function(b,c){b&&b!==c&&(a.country=_.find(a.countries,function(b){return b.getName()===a.countryName}))}),a.$watch("profile.Moniker",function(b,c){b&&b!==c&&a.validateMoniker()}),a.$on(d.importer.reviewsReady,function(a,b){j.show({content:"Reviews imported from "+b.provider,type:"success"})}),a.$on(d.profile.profileUpdated,function(){c(function(){a.profile=g.getProfile()})}),h.getCountries().then(function(b){a.countries=b,a.countryNames=_.map(b,function(a){return a.getName()})},function(a){console.log(a)}),g.fetchProfileStatus().then(function(){a.profileExists=!0,g.fetchOwnProfile().then(function(){a.profile=g.getProfile(),h.fetchLocationNames(a.profile.LocationID).then(function(b){a.cityName=b.results[0].value[0].Name.Literals[0].Text,a.countryName=b.results[0].value[0].Parent.Name.Literals[0].Text})},function(a){console.log(a)})},function(){a.profileExists=!1,i.fetchProfile().then(function(){c(function(){a.profile=g.getProfile()})},function(a){console.log(a)})})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ApplyImportCtrl",["$scope","EVENTS","MESSAGES","ImporterSvc","NotificationSvc",function(a,b,c,d,e){a.importers=d.getImporters(),a.selected=new d.ImporterCollection,a.selectedImporters=a.selected.importers,a.done=d.getImporters("profileDone"),a.toggleSelection=function(c){return a.isSelected(c)?void _.remove(a.selectedImporters,c):(a.selectedImporters.push(c),void a.$broadcast(b.ui.providerSelected,c.provider))},a.isSelected=function(b){return a.selectedImporters.indexOf(b)>-1},a["import"]=function(){d["import"](a.selected)},a.$on(b.importer.profileReady,function(b,d){e.show({content:c.success.profileImported+d.provider,type:"success"}),a.goToStep(1)})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("OfferCtrl",["$scope","$modal","PATHS","EVENTS","offer","ReviewSvc","UserSvc","PortfolioSvc","CatalogueSvc","ProfileSvc","LocationSvc",function(a,b,c,d,e,f,g,h,i,j,k){a.reviews=[],a.portfolio={},a.service={},a.offer=e,a.isCurrentUser=!1,a.expandServiceDescription=!1;var l=b({scope:a,template:"views/components/modalContactUser.html",show:!1,animation:"am-slide-top",keyboard:!1});a.range=function(a){return _.range(0,a)},a.showContactModal=function(){l.$promise.then(l.show)},a.closeContactModal=function(){l.$promise.then(l.hide)},j.fetchProfileById(a.offer.SellerProfileID).then(function(b){a.profile=b[0],a.avatarUrl=a.profile.User&&a.profile.User.Avatar?encodeURI(c.file.hosted+a.profile.User.Avatar.RelativeUrl):null,a.isCurrentUser=a.profile.ID===a.currentUser.ID,a.$broadcast(d.profile.fetchProfileSuccess,a.isCurrentUser),k.fetchLocationNames(a.profile.LocationID).then(function(b){a.profile.countryName=b.results[0].value[0].Parent.Name.Literals[0].Text},function(a){console.log(a)})},function(a){console.log(a)}),f.fetchReviews(a.offer.SellerProfileID).then(function(b){a.reviews=b},function(a){console.log(a)}),i.getService(a.offer.ServiceID).then(function(b){a.service=b},function(a){console.log(a)}),h.fetchShowcases(a.offer.ID).then(function(b){a.offer.Showcases=b,h.setPortfolio(b)},function(a){console.log(a)})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ModalImageCropCtrl",["$http","$rootScope","$scope","$timeout","$upload","PATHS","EVENTS","MESSAGES","Utils","UserSvc","NotificationSvc",function(a,b,c,d,e,f,g,h,i,j,k){c.file={},c.init=function(a){c.uncroppedImage="",c.croppedImage="",c.tempImage="",c.setProgress(a)},c.updateCroppedImage=function(a){c.croppedImage=a},c.onFileSelect=function(a){var b=new FileReader;b.onloadstart=function(){c.setProgress(!0)},b.onload=function(a){d(function(){c.uncroppedImage=a.target.result,c.setProgress(!1)})},b.readAsDataURL(a[0]),c.file=a[0]},c.setProgress=function(a){c.inProgress=a},c.saveAvatar=function(){var b=new FormData,d=c.croppedImage.split(",").pop(),e=c.file.name.split(".").slice(0,1)[0].concat(".png");b.append(e,i.base64toBlob(d,"image/png"),e),a.post(f.user.ownAvatar,b,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(){j.fetchOwnUser().then(function(){c.$hide()},function(a){console.log(a),k.show({content:h.error.generic,type:"error"})})},function(a){console.log(a)})},c.init()}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ForgotPwdCtrl",["$scope","AccountSvc","MESSAGES","NotificationSvc",function(a,b,c,d){a.email="",a.forgotPassword=function(){b.forgotPassword(a.email).then(function(b){console.log(b),d.show({content:c.success.createNewPassword,type:"success"}).then(function(){a.go("/login")})},function(){d.show({content:c.error.generic,type:"error"})})}}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("ResetPwdCtrl",["$scope","MESSAGES","AccountSvc","NotificationSvc",function(a,b,c,d){a.oldPassword="",a.newPassword="",a.confirmPassword="",a.resetPassword=function(){var e={OldPassword:a.oldPassword,NewPassword:a.newPassword,ConfirmPassword:a.confirmPassword};c.resetPassword(e).then(function(){d.show({content:b.success.resetPassword,type:"success"}).then(function(){a.go("/login")})},function(){d.show({content:b.error.generic,type:"error"})})}}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("HeaderCtrl",["$rootScope","$scope","EVENTS","AccountSvc",function(a,b,c,d){b.logout=function(){d.logout().then(function(){a.$broadcast(c.auth.logoutSuccess,event)},function(b){a.$broadcast(c.auth.logoutFailed,event,b)})},b.dropdown=[{text:"Change Password",href:"#resetPassword"},{divider:!0},{text:"Signout",click:b.logout}],b.$on(c.profile.fetchProfileSuccess,function(){b.currentUser&&b.currentUser.Profile&&(b.dropdown=[{text:"My Profile",href:"#"+b.currentUser.Profile.Moniker},{text:"Change Password",href:"#resetPassword"},{divider:!0},{text:"Signout",click:b.logout}])})}])}(),function(){"use strict";var a=angular.module("fvApp");a.controller("LandingCtrl",["$scope","ProfileSvc",function(a,b){a["continue"]=function(){a.go(a.session.hasRegistered?"/apply":"/register")},b.setActiveStep("import")}])}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvOrderBox",["$location","MESSAGES","EVENTS","ProfileSvc","OfferSvc","NotificationSvc",function(a,b,c,d,e,f){return{restrict:"E",scope:{offer:"="},replace:!0,templateUrl:"views/directives/fv-order-box.html",link:function(g){var h,i=g.offer,j=g.offer.Service;g.addons=[],g.mainPriceDiscriminator={},g.isCurrentUser=!1,g.editOffer=function(){e.fetchOwnOffer(j.ID).then(function(){d.setActiveStep("offer_config"),a.path("/apply")},function(){f.show({content:b.error.generic,type:"error"})})},g.$on(c.profile.fetchProfileSuccess,function(a,b){g.isCurrentUser=b}),_.each(j.Options,function(a){switch(!0){case!a.IsPriceDiscriminator:break;case a.IsMandatory:g.mainPriceDiscriminator=a;break;default:g.addons.push(a)}}),_.each(i.OfferedChoices,function(a){h=_.find(g.addons,function(b){return b.ID===a.ServiceChoice.Option.ID}),h&&(h.Choices[0].price=a.Price,h.Choices[0].days=a.Days),_.each(g.mainPriceDiscriminator.Choices,function(b){b.ID===a.ServiceChoiceID&&(b.price=a.Price,b.days=a.Days)})})}}}])}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvPortfolioViewer",["Odata","PortfolioSvc",function(a,b){var c=7;return{restrict:"E",scope:!0,templateUrl:"views/directives/fv-portfolio-viewer.html",link:function(d){d.showcases=b.getPortfolio(),d.showcaseItems=[],d.showcasePrev=function(){d.showcaseIndex>0&&(d.showcaseIndex-=1)},d.showcaseNext=function(){d.showcaseIndex<d.showcases.length-1&&(d.showcaseIndex+=1)},d.goToShowcaseItem=function(a){d.showcaseIndex=a},_.each(d.showcases,function(b){d.showcaseItems.push(new a.ShowcaseItem(b.Items[0]))}),d.$watch("showcaseIndex",function(a,b){a>=c&&a>b&&(d.galleryIndex+=1),a>0&&b>a&&(d.galleryIndex-=1)})}}}])}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvDynamicIcon",function(){return{restrict:"E",scope:!0,templateUrl:"views/directives/fv-dynamic-icon.html",link:function(a,b,c){a.provider=c.provider}}})}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvShowcaseItem",["$sce","FILE_TYPE_CONFIG","PATHS","Odata",function(a,b,c,d){return{restrict:"E",scope:!0,templateUrl:"views/directives/fv-showcase-item.html",link:function(c){if(c.showcase)switch(c.link=null,c.item=new d.ShowcaseItem(c.showcase.Items[0]),!0){case c.item.File.hasOwnProperty("EmbedCode"):c.type="embedCode",c.trustedPlayer=a.trustAsHtml(c.item.File.EmbedCode);break;case c.item.File.hasOwnProperty("RelativeUrl"):c.link=c.item.getFileLink(),c.type=_.find(b,function(a){return a.ID===c.item.File.MimeTypeID}).Viewer;break;default:c.link=c.item.File.AbsoluteUrl,c.type=_.find(b,function(a){return a.ID===c.item.File.MimeTypeID}).Viewer}}}}])}(),function(){"use strict";var a=angular.module("fvApp");a.directive("fvShowcaseThumb",["Odata",function(a){return{restrict:"E",scope:{showcase:"=",caption:"@"},templateUrl:"views/directives/fv-showcase-thumb.html",link:function(b){var c=new a.ShowcaseItem(b.showcase.Items[0]);switch(b.thumbnailLink="",!0){case!c.hasOwnProperty("Thumbnail")||null===c.Thumbnail:b.thumbnailLink="images/thumb.png";break;case c.Thumbnail.hasOwnProperty("Url"):b.thumbnailLink=c.Thumbnail.Url;break;case c.Thumbnail.hasOwnProperty("RelativeUrl"):b.thumbnailLink=c.getFileLink()}}}}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("LocationSvc",["$q","$http","breeze","PATHS","Odata",function(a,b,c,d,e){function f(a){return _.map(a,function(a){return new e.Location(a)})}var g={},h=new c.DataService({serviceName:d["public"],hasServerMetadata:!1}),i=new c.EntityManager({dataService:h});return g.searchCity=function(c,e){var g=a.defer(),h=[d["public"],"CitiesByPrefix","?format=json","&countryID=",c,"&prefix=","'",e,"'","&$format=json","&$expand=Name/Literals"].join("");return b.get(h).then(function(a){console.log(a),g.resolve(f(a.data.value))},function(a){g.reject(a)}),g.promise},g.fetchLocationNames=function(a){var b=new c.EntityQuery("Locations").where("ID","eq",a).expand("Name.Literals,Parent.Name.Literals");return i.executeQuery(b)},g.getCountries=function(){var b=a.defer(),d=new c.EntityQuery("CountriesLocations").expand("Name.Literals");return i.executeQuery(d).then(function(a){b.resolve(f(a.results[0].value))},function(a){console.log(a)}),b.promise},g}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("AccountSvc",["$q","$http","PATHS","MESSAGES","NotificationSvc",function(a,b,c,d,e){var f={};return f.register=function(a){return b.post(c.account.register,{Email:a.email,Password:a.password,ConfirmPassword:a.password,FirstName:a.firstName,LastName:a.lastName})},f.login=function(a){return b.post(c.account.login,{Email:a.email,Password:a.password,RememberMe:!0})},f.logout=function(){return b.post(c.account.logout,{})},f.forgotPassword=function(b){var c=a.defer();return c.resolve(b),c.promise},f.resetPassword=function(a){return b.post(c.account.resetPassword,a)},f.getUserInfo=function(){var d=a.defer();return b.get(c.account.userInfo).then(function(a){d.resolve({email:a.data.UserName,userID:a.data.UserID,authProvider:a.data.LoginProvider,hasRegistered:a.data.HasRegistered})},function(a){console.log(a),d.reject(a)}),d.promise},f.externalLogins=function(){return b.get(c.account.externalLogins)},f.externalLogin=function(a){f.externalLogins().then(function(b){window.location.replace(c.root+_.find(b.data,function(b){return b.Name===a}).Url)},function(a){console.log(a),e.show({content:d.error.generic,type:"error"})})},f}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("CatalogueSvc",["$http","$q","$timeout","breeze","PATHS",function(a,b,c,d,e){function f(a){return _.pluck(a.results[0].value,function(a){return{categoryID:a.ID,categoryName:a.Name.Literals[0].Text}})}function g(a){return _.pluck(a.results[0].value,function(a){return{serviceID:a.ID,shortTitle:a.ShortTitle.Literals[0].Text,thumbnail:{link:a.ThumbnailFile.Url}}})}function h(a){return a.results[0]["odata.count"]}function i(a){var b=a.results[0].value[0],c={serviceID:b.ID,title:b.Title&&b.Title.Literals[0].Text,shortTitle:b.ShortTitle&&b.ShortTitle.Literals[0].Text,description:b.Description&&b.Description.Literals[0].Text,deliverables:b.ExpectedDeliverables&&b.ExpectedDeliverables.Literals[0].Text,provision:b.BuyerProvision&&b.BuyerProvision.Literals[0].Text,options:b.Options,excluded:b.ExcludedServices&&b.ExcludedServices.Literals[0].Text,viewHint:b.ViewHint,thumbnail:{link:b.ThumbnailFile.Url},showcasePrompt:b.ShowcasePrompt&&b.ShowcasePrompt.Literals[0].Text};return c.allowedShowcaseFileTypes=_.pluck(b.AllowedShowcaseFileTypes,function(a){return a.Name&&a.Name.Literals[0].Text}),c.options=b.Options.map(function(a){return{ID:a.ID,isPriceDiscriminator:a.IsPriceDiscriminator,isMandatory:a.IsMandatory,isDaysDiscriminator:a.IsDaysDiscriminator,sellerTitle:a.SellerTitle&&a.SellerTitle.Literals[0].Text,choices:a.Choices.map(function(a){return{ID:a.ID,name:a.Name&&a.Name.Literals[0].Text,price:0,days:1}})}}),c.fields=b.Fields.map(function(a){return{ID:a.ID,allowedFileTypes:_.pluck(a.AllowedFileTypes,function(a){return a.Name&&a.Name.Literals[0].Text}),order:a.Order,isMandatory:a&&a.IsRequired?!0:!1,sellerLabel:a&&a.SellerLabel&&a.SellerLabel.Literals[0].Text}}),c.interview=_.find(c.fields,function(a){return 0===a.order}),_.remove(c.fields,function(a){return 0===a.order}),c}var j={},k=new d.DataService({serviceName:e.cached,hasServerMetadata:!1}),l=new d.EntityManager({dataService:k});return j.services=[],j.batch=16,j.getRootCategories=function(){var a=b.defer(),c=new d.EntityQuery("RootCategories").expand("Name.Literals");return l.executeQuery(c).then(function(b){var c=f(b);c.unshift({categoryID:null,categoryName:"All"}),a.resolve(c)},function(b){a.reject(b)}),a.promise},j.getService=function(a,c){var e=b.defer(),f=new d.EntityQuery("Services").where("ID","eq",a).expand(["Title.Literals","ShortTitle.Literals","Description.Literals","ThumbnailFile","ExpectedDeliverables.Literals","BuyerProvision.Literals","ExcludedServices.Literals","AllowedShowcaseFileTypes.Name.Literals","ShowcasePrompt.Literals","Fields","Fields.AllowedFileTypes.Name.Literals","Fields.AllowedFileTypes.MimeTypes","Fields.SellerLabel.Literals","Fields.Order","Options.SellerTitle.Literals","Options.Choices.Name.Literals"].join(", "));return l.executeQuery(f).then(function(a){e.resolve(c?i(a):a.results[0].value[0])},function(a){e.reject(a)}),e.promise},j.getServices=function(a){var c=b.defer(),e=new d.EntityQuery("Services").expand("ShortTitle.Literals, ThumbnailFile");return j.services.length>0&&c.resolve(j.services.slice(a,a+j.batch)),0===j.services.length&&l.executeQuery(e).then(function(b){j.services=g(b),c.resolve(j.services.slice(a,a+j.batch))},function(a){c.reject(a)}),c.promise},j.getServicesUnderCategory=function(a,c){var e=b.defer(),f=new d.EntityQuery("ServicesUnderCategory").withParameters({CategoryID:a}).skip(c).take(j.batch).expand("ShortTitle.Literals, ThumbnailFile").inlineCount();return l.executeQuery(f).then(function(a){e.resolve({services:g(a),totalCount:h(a)})},function(a){e.reject(a)}),e.promise},j}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("OfferSvc",["$http","$q","$timeout","Enum","PATHS","breeze","PortfolioSvc",function(a,b,c,d,e,f,g){var h={},i={},j=[],k=new f.DataService({serviceName:e["public"],hasServerMetadata:!1}),l=new f.EntityManager({dataService:k});return h.addOffer=function(a){var b=a||i;j.push(b)},h.removeOffer=function(a){var b=a||i.serviceID;j.remove(function(a){return a.serviceID===b})},h.getOffer=function(){return i},h.fetchOffers=function(a){var c=b.defer(),d=new f.EntityQuery("Offers").where("SellerProfileID","eq",a).expand(["Service","Service.ShortTitle.Literals","Service.ThumbnailFile"].join(","));return l.executeQuery(d).then(function(a){j=a.results[0]&&a.results[0].value,c.resolve(j)},function(a){console.log(a),c.reject(a)}),c.promise},h.fetchOwnOffer=function(c){var d=b.defer(),f=[e.offerManagement.ownOffers,"?serviceID=",c,"&expand=Fields/File,","Fields/Thumbnail"].join("");return a.put(f).then(function(a){i=a.data,d.resolve(i)},function(a){d.reject(a)}),d.promise},h.fetchOffer=function(a){var c=b.defer(),d=new f.EntityQuery("Offers").where("ID","eq",parseInt(a)).expand(["Service","Service.Options","Service.ShortTitle.Literals","Service.ThumbnailFile","Service.Options.SellerTitle.Literals","Service.Options.BuyerTitle.Literals","Service.Options.Choices","OfferedChoices.ServiceChoice.Option","Fields.File","Fields.Text.Literals","Fields.ServiceField.SellerLabel.Literals"].join(","));return l.executeQuery(d).then(function(a){i=a.results[0]&&a.results[0].value[0],i?(g.setPortfolio(i.Showcases),c.resolve(i)):c.reject()},function(a){console.log(a),c.reject(a)}),c.promise},h.fetchOfferedServices=function(){var c=b.defer();return a.get(e.offerManagement.offeredServices).then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise},h.saveOffer=function(b){return a({method:"PATCH",url:e.offerManagement.ownOffers+"/"+b.ID,data:b})},h.saveOfferField=function(b,c,d){return a({method:"PUT",url:[e.offerManagement.ownOffers,"/",b,"/Fields/Inline?ServiceFieldID=",c].join(""),data:JSON.stringify(d)})},h.saveInterviewVideo=function(b,c,d,f){var g=[e.offerManagement.ownOffers,"/",b,"/Fields","?serviceFieldID=",c,"&useDirectLinks=true"].join("");return a({method:"PUT",url:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:{url:d,thumbnailUrl:f}})},h.saveOfferChoice=function(b){return a({method:"PUT",url:[e.offerManagement.ownOffers,"/",b.offerID,"/Choices?serviceChoiceID=",b.serviceChoiceID,"&price=",b.price,"&days=",b.days].join("")})},h.removeOwnOffer=function(b){return a["delete"](e.offerManagement.ownOffers+"/"+b)},h}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("ProfileSvc",["$http","$q","$upload","$timeout","IMPORT_PROVIDERS","PATHS","breeze","Utils","Odata",function(a,b,c,d,e,f,g,h,i){var j={},k=e,l=["import","info","service_selection","offer_config","storefront"],m="import",n=new i.SellerProfile,o=new g.DataService({serviceName:f["public"],hasServerMetadata:!1}),p=new g.EntityManager({dataService:o});return j.Provider=function(a,b){this.name=a,this.url=b},j.initProviders=function(){var a={};return _.forEach(k,function(b){a[b]=new j.Provider(b,"")}),a},j.getActiveStep=function(){return m},j.getProfile=function(){return n},j.getSteps=function(){return l},j.setActiveStep=function(a){m=a},j.updateProfile=function(a){h.updateProperties(n,a)},j.createProfile=function(b){return a.post(f.sellerManagement.ownProfile,b)},j.patchProfile=function(b){return a({method:"PATCH",url:f.sellerManagement.ownProfile,data:b})},j.fetchOwnProfile=function(){var c=b.defer();return a.get(f.sellerManagement.ownProfile+"?expand=User, Title/Literals, Description/Literals").then(function(a){h.updateProperties(n,a.data),c.resolve(n)},function(a){c.reject(a)}),c.promise},j.fetchProfile=function(c){var d=b.defer(),e=[f.sellerManagement.profile,c,"?expand=Location/Name/Literals,","Title/Literals,","Description/Literals"].join("");return a.get(e).then(function(a){h.updateProperties(n,a.data),d.resolve(n)},function(a){d.reject(a)}),d.promise},j.fetchProfileById=function(a){var c=b.defer(),d=new g.EntityQuery("SellerProfiles").where("ID","eq",a).expand(["User","User.Avatar","Location.Name.Literals","Title.Literals","Description.Literals"].join(","));return p.executeQuery(d).then(function(a){console.log(a),c.resolve(a.results[0].value)},function(a){console.log(a),c.reject(a)}),c.promise},j.fetchProfileStatus=function(){var c=b.defer();return a.get(f.sellerManagement.profileStatus).then(function(a){a&&"null"!==a.data?c.resolve():c.reject()},function(a){console.log(a)}),c.promise},j.validateMoniker=function(b){return a.get(f.sellerManagement.monikerExists(b))},j}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("ImporterSvc",["$rootScope","$http","$q","$timeout","$interval","PATHS","PROVIDERS_ENUM","EVENTS","MESSAGES","Utils","Odata",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){if(a){var b=[];
switch(null!==a.Profile&&2===a.Profile&&b.push("profile"),null!==a.Reviews&&2===a.Reviews&&b.push("reviews"),null!==a.Portfolio&&2===a.Portfolio.CurrentStatus&&b.push("portfolio"),b.length){case 0:return["none"];case 3:return["all"];default:return b}}}function m(b,c){var e;switch(b){case"profile":e=h.importer.profileReady;break;case"portfolios":e=h.importer.portfoliosReady;break;case"reviews":e=h.importer.reviewsReady}d(function(){a.$broadcast(e,c)})}function n(){b.post(f.importer.checkProgress,u.capitalize()).then(function(b){var c,d;a.$broadcast(h.importer.status,b),_.each(b.data,function(a){if(c=_.pluck(u.importers,"guid").indexOf(a.Guid),d=c>-1?u.importers[c]:null,d&&-1===l(a).indexOf("none")){if(l(a).indexOf("all")>-1&&(0===q.importers.length||-1===q.importers.indexOf(d)))return-1===q.importers.indexOf(d)&&q.importers.push(d),u.importers.splice(c,1),m("profile",d),m("portfolios",d),void m("reviews",d);l(a).indexOf("profile")>-1&&(0===r.importers.length||-1===r.importers.indexOf(d))&&(r.importers.push(d),m("profile",d)),l(a).indexOf("portfolio")>-1&&(0===t.importers.length||-1===t.importers.indexOf(d))&&(t.importers.push(d),m("portfolios",d)),l(a).indexOf("reviews")>-1&&(0===s.importers.length||-1===s.importers.indexOf(d))&&(s.importers.push(d),m("reviews",d))}})},function(a){console.log(a)})}function o(a){return _.map(a.data,function(a){return new A.Importer({provider:a.Provider,url:a.Url,guid:a.Guid})})}var p,q,r,s,t,u,v,w,x,y=_.keys(g),z=[],A={};return w=function(){e.cancel(v)},x=function(){n(),v=e(function(){u.getImporters().length>0?n():w()},6e3,100,!1)},A.Importer=function(a){var b=this;b.provider="",b.url="",b.guid="",j.updateProperties(b,a)},A.Importer.prototype.capitalize=function(){return{Provider:this.provider,Url:this.url,Guid:this.guid}},A.ImporterCollection=function(){this.importers=[]},A.ImporterCollection.prototype.getImporters=function(){return this.importers},A.ImporterCollection.prototype.setImporters=function(a){this.importers=a},A.ImporterCollection.prototype.addImporters=function(a){return this.importers=_.union(this.importers,a),this},A.ImporterCollection.prototype.capitalize=function(){return _.map(this.importers,function(a){return a.capitalize()})},A.getImporters=function(a){switch(a){case"inProgress":return u.getImporters();case"done":return q.getImporters();case"profileDone":return r.getImporters();case"portfoliosDone":return t.getImporters();default:return p.getImporters()}},A["import"]=function(a){var d=c.defer();return b.post(f.importer["import"],a.capitalize()).then(function(a){u.addImporters(o(a)),!angular.isDefined(v)&&x()},function(a){console.log(a)}),d.promise},A.fetchProfile=function(){var a=c.defer();return 0===r.importers.length&&a.reject(i.error.profileImportFailed),r.importers.length>0&&b.post(f.importer.fetchProfile,r.capitalize()).then(function(b){a.resolve(new k.SellerProfile(b.data[0].data.response.data.PersonalInfo))},function(b){console.log(b),a.reject(b)}),a.promise},A.fetchPortfolios=function(){var a=c.defer(),d=new A.ImporterCollection;return d.setImporters(_.union(u.importers,t.importers,q.importers)),t&&b.post(f.importer.fetchPortfolios,d.capitalize()).then(function(b){z=b,a.resolve(b)},function(b){console.log(b),a.reject(b)}),a.promise},A.saveReviews=function(){var a=new A.ImporterCollection;return a.setImporters(_.union(s.importers,q.importers)),b.post(f.sellerManagement.ownReviews,a.capitalize())},A.fetchCachedPortfolios=function(a){return b.post(f.importer.fetchPortfolios,_.map(y,function(b){return{Guid:a,Provider:b,Url:""}}))},A.saveImportedPortfolios=function(a,c){return b.post(f.sellerManagement.importedShowcases+a,c)},a.$on(h.auth.sessionTimeout,function(){w()}),p=new A.ImporterCollection,q=new A.ImporterCollection,u=new A.ImporterCollection,r=new A.ImporterCollection,s=new A.ImporterCollection,t=new A.ImporterCollection,_.each(y,function(a){p.importers.push(new A.Importer({provider:a}))}),A}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("UserSvc",["$rootScope","$http","$q","PATHS","EVENTS","Odata","breeze",function(a,b,c,d,e,f,g){var h={},i=new g.DataService({serviceName:d["public"],hasServerMetadata:!1}),j=new g.EntityManager({dataService:i});return h.fetchOwnUser=function(){var g=c.defer();return b.get(d.user.self).then(function(b){var c=new f.User(b.data);a.$broadcast(e.user.updateSuccess,c),g.resolve(c)},function(a){g.reject(a)}),g.promise},h.fetchUser=function(a){var b=c.defer(),d=new g.EntityQuery("User/Futurvention.Ergma.DataAccess.EntityFramework.ErgmaUser").expand("Avatar").where("ID","eq",a);return j.executeQuery(d).then(function(a){b.resolve(a.results[0].value[0])},function(a){b.reject(a)}),b.promise},h}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("PortfolioSvc",["$http","$q","$timeout","breeze","PATHS",function(a,b,c,d,e){var f={},g={},h=new d.DataService({serviceName:e["public"],hasServerMetadata:!1}),i=new d.EntityManager({dataService:h});return f.updatePortfolio=function(a){angular.extend(g,a)},f.setPortfolio=function(a){g=a},f.getPortfolio=function(){return g},f.fetchPortfolio=function(a){var c=b.defer(),e=new d.EntityQuery("Showcases").where("SellerProfileID","eq",a).expand(["Items.File","Items.Thumbnail","Items.Title.Literals"].join(","));return i.executeQuery(e).then(function(a){c.resolve(_.uniq(a.results[0].value))},function(a){c.reject(a)}),c.promise},f.saveUrls=function(b,c){return a.put(e.sellerManagement.showcases+c,b)},f.saveShowcases=function(b,c){return a({method:"PUT",url:[e.offerManagement.ownOffers,"/",b,"/Showcases"].join(""),data:c})},f.fetchShowcases=function(c){var d=b.defer(),f=[e.offerManagement.ownOffers,"/",c,"/Showcases"].join("");return a.get(f).then(function(a){d.resolve(a.data)},function(a){d.reject(a)}),d.promise},f}])}(),function(){"use strict";var a=angular.module("fvApp");a.service("ReviewSvc",["$q","$http","breeze","PATHS",function(a,b,c,d){var e={},f=new c.DataService({serviceName:d["public"],hasServerMetadata:!1}),g=new c.EntityManager({dataService:f});return e.fetchReviews=function(b){var d=a.defer(),e=new c.EntityQuery("SellerReviews").expand("User, Text.Literals").where("SellerProfile.ID","eq",b);return g.executeQuery(e).then(function(a){d.resolve(_.filter(a.results[0].value,function(a){return""!==a.Text.Literals[0].Text}))},function(a){d.reject(a)}),d.promise},e}])}();